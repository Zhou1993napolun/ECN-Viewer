(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e){e.exports={palette:{common:{black:"#000",white:"#fff"},background:{paper:"#fff",default:"rgba(250, 252, 255, 1)"},primary:{light:"rgba(65, 119, 153, 1)",main:"rgba(0, 46, 67, 1)",dark:"rgba(0, 33, 48, 1)",contrastText:"#fff"},secondary:{light:"rgba(248, 159, 163, 1)",main:"rgba(255, 88, 93, 1)",dark:"rgba(247, 61, 68, 1)",contrastText:"#fff"},error:{light:"#e57373",main:"#f44336",dark:"#d32f2f",contrastText:"#fff"},text:{primary:"rgba(0, 46, 67, 1)",secondary:"rgba(87, 104, 125, 1)",disabled:"rgba(172, 181, 198, 1)",hint:"rgba(87, 104, 125, 1)"}}}},125:function(e){e.exports=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]},126:function(e,t,a){e.exports=a.p+"static/media/logomark.380acb6b.svg"},142:function(e,t,a){e.exports=a(229)},147:function(e,t,a){},225:function(e,t,a){},226:function(e,t,a){},228:function(e,t,a){},229:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(15),o=a.n(c),l=(a(147),a(283)),s=a(12),i=a(81),u=a(48),m=a(204),p=a(128),d=a.n(p),f=a(129),g=a.n(f),b=a(130),v=a.n(b),h=a(131),E=a.n(h),x=a(132),y=a.n(x),w=a(8),k=a.n(w),j=a(14),O=a(6);var C=a(20),N=a(272),T=a(233),S=a(79),I=a.n(S),A=a(58),F=a(264),R=a(291),P=a(293),M=a(267),D=a(230),U=a(268),W=a(269),z=a(111),L=a.n(z),B=a(112),_=a.n(B),q=a(113),H=a.n(q),G=a(136),J="ControllerName",K="Controller",V=Object(T.a)(function(e){return{controllerInfo:{paddingTop:"0px","& .paper":{padding:"5px"}},controllerName:{fontSize:"1.5rem",fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif',fontWeight:400,lineHeight:1.33,letterSpacing:"0em",width:"100%","&::before":{borderBottom:"none !important"}},warningChip:{backgroundColor:"var(--color, ".concat(e.colors.danger,")"),color:"white"},controllerTitle:{display:"flex",justifyContent:"space-between",alignItems:"baseline",textEmphasis:"bold"}}});function Y(e){var t=V(),a=Object(G.a)(),n=e.controller,c=e.loading,o=e.error,l=n.location||{},i=l.city,u=l.country,m=l.lat,p=l.lon,d=l.query,f=o||n.error||null,g=r.a.useState(function(){return window.localStorage.getItem(J)||K}),b=Object(s.a)(g,2),v=b[0],h=b[1];return r.a.useEffect(function(){window.document.title=v!==K?v:"ECN Viewer"},[v]),r.a.createElement("div",{className:t.controllerInfo},r.a.createElement("div",{className:t.controllerTitle},r.a.createElement(A.a,{style:{width:"100%"},variant:"h5"},r.a.createElement(F.a,{className:t.controllerName,value:v,onChange:function(e){var t=e.target.value;window.localStorage.setItem(J,t),h(t)}})),f&&r.a.createElement(R.a,{title:f.message,"aria-label":"Error"},r.a.createElement(P.a,{label:"The controller is not reachable",style:{"--color":a.colors.gold},className:t.warningChip}))),r.a.createElement(M.a,null,r.a.createElement(D.a,null,r.a.createElement(U.a,null,r.a.createElement(L.a,null)),c?r.a.createElement(W.a,null,r.a.createElement(I.a,null)):r.a.createElement(W.a,{primary:"".concat(i,", ").concat(u)})),r.a.createElement(D.a,{style:{cursor:"pointer"},onClick:function(){return e.selectController()}},r.a.createElement(U.a,null,r.a.createElement(_.a,null)),c?r.a.createElement(W.a,null,r.a.createElement(I.a,null)):r.a.createElement(W.a,{primary:"".concat(m,", ").concat(p)})),r.a.createElement(D.a,null,r.a.createElement(U.a,null,r.a.createElement(H.a,null)),c?r.a.createElement(W.a,null,r.a.createElement(I.a,null)):r.a.createElement(W.a,{primary:d}))))}var Q=a(231),X=Object(T.a)({summary:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridColumnGap:"15px",textAlign:"center"}});function Z(e){var t=X(),a=e.activeFlows,n=e.activeAgents,c=e.activeMsvcs,o=e.loading;return r.a.createElement("div",null,r.a.createElement(A.a,{variant:"h5"},"Active resources"),r.a.createElement("br",null),r.a.createElement("div",{className:t.summary},r.a.createElement(Q.a,null,r.a.createElement(A.a,{variant:"h3"},o?0:a.length),r.a.createElement(A.a,{variant:"subtitle1"},"Flows")),r.a.createElement(Q.a,null,r.a.createElement(A.a,{variant:"h3"},o?0:n.length),r.a.createElement(A.a,{variant:"subtitle1"},"Agents")),r.a.createElement(Q.a,null,r.a.createElement(A.a,{variant:"h3"},o?0:c.length),r.a.createElement(A.a,{variant:"subtitle1"},"Microservices"))))}var $=a(62),ee=a.n($),te=a(280),ae=a(281),ne=a(134),re=a(277),ce=a(121),oe=a.n(ce),le=a(77),se=a.n(le),ie=a(270),ue=a(133),me=a(114),pe={phosphorus:"#FF585D",cobalt:"#5064EC",gold:"#F5A623",chromium:"#00C0A9",argon:"#7A3BFF",carbon:"#002E43",lead:"#57687D",aluminium:"#ACB5C6",silver:"#FAFCFF",white:"#FFFFFF"},de=Object(ue.a)(Object(O.a)({},me,{colors:Object(O.a)({},pe,{success:pe.chromium,error:pe.phosphorus,danger:pe.gold})}));function fe(e){return r.a.createElement(ie.a,{theme:de},e.children)}var ge={RUNNING:de.colors.chromium,UNKNOWN:de.colors.aluminium,OFFLINE:de.colors.phosphorus},be={RUNNING:de.colors.cobalt,UNKNOWN:de.colors.aluminium,OFFLINE:de.colors.aluminium},ve=a(285),he=a(271),Ee=a(47),xe=a.n(Ee),ye=Object(T.a)(function(e){return{modalTitle:{backgroundColor:e.colors.carbon,borderRadius:"4px 4px 0 0",color:"white",padding:"5px",display:"flex",justifyContent:"space-between"},modal:{width:"60%",top:"15%",left:"20%",position:"absolute",borderRadius:"4px"},modalContent:{maxHeight:"600px",overflowY:"scroll",padding:"15px"},modalActions:{display:"flex",backgroundColor:e.colors.silver,alignItems:"flex-end"},modalAction:{marginLeft:"5px"}}});function we(e){var t=ye(),a=e.title,n=e.open,c=e.onClose;return r.a.createElement(ve.a,Object.assign({"aria-labelledby":"".concat(a," modal")},{open:n,onClose:c}),r.a.createElement(Q.a,{className:t.modal},r.a.createElement("div",{className:t.modalTitle},r.a.createElement(A.a,{variant:"h5"},a),r.a.createElement(xe.a,{style:{cursor:"pointer"},onClick:c})),r.a.createElement("div",{className:t.modalContent},e.children),e.actions&&!!e.actions.length&&r.a.createElement("div",{className:t.modalActions},e.actions.map(function(e){return r.a.createElement(he.a,{className:"".concat(e.className," ").concat(t.modalAction),variant:e.variant,onClick:e.onClick},e.text)}))))}var ke=a(273),je=Object(T.a)(function(e){return{divider:{margin:"5px"}}});function Oe(e){var t=je(),a=e.open,n=e.onClose,c=e.title,o=e.onConfirm;return r.a.createElement(we,{title:c,open:a,onClose:n},e.children,r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,justify:"flex-end",spacing:2},r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{onClick:n},"Cancel")),r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{variant:"contained",color:"primary",onClick:o},"Confirm"))))}var Ce=a(17),Ne=a(275),Te=a(116),Se=a.n(Te),Ie=a(115),Ae=a.n(Ie),Fe=a(117),Re=a.n(Fe),Pe=a(118),Me=a.n(Pe),De=a(232),Ue=a(274),We={success:Ae.a,warning:Se.a,error:Re.a,info:Me.a},ze=Object(De.a)(function(e){return{success:{backgroundColor:e.colors.success},error:{backgroundColor:e.colors.error},info:{backgroundColor:e.colors.cobalt},warning:{backgroundColor:e.colors.danger},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"},alert:{margin:"5px",borderRadius:"4px",boxShadow:"0 4px 6px 0 ".concat(e.colors.carbon)},container:{display:"flex",flexDirection:"column",position:"fixed",bottom:"10px",left:"10px",zIndex:"9999"}}});function Le(e){var t=ze(),a=e.open,n=e.alerts;return a?r.a.createElement("div",{className:t.container},n.map(function(e,a){var n=e.type||"info",c=We[n];return r.a.createElement(Ue.a,{key:e.key||e.id||a,className:"".concat(t[n]," ").concat(t.alert," ").concat(e.className),"aria-describedby":"client-snackbar",message:r.a.createElement("span",{id:"client-snackbar",className:t.message},r.a.createElement(c,{className:"".concat(t.icon," ").concat(t.iconVariant)}),e.message),action:[r.a.createElement(Ne.a,{key:"close","aria-label":"Close",color:"inherit",onClick:e.onClose},r.a.createElement(xe.a,{className:t.icon}))]})})):null}var Be=r.a.createContext({feedbacks:[],setFeedbacks:function(){},pushFeedback:function(){}}),_e={ADD:"add",REMOVE:"remove",SET:"set"},qe={feedbacks:[],nextId:0},He=function(e,t){switch(t.type){case _e.ADD:return{feedbacks:[].concat(Object(Ce.a)(e.feedbacks),[Object(O.a)({},t.data,{timeout:setTimeout(function(){t.dispatch({type:_e.REMOVE,data:{id:e.nextId}})},6e3),id:e.nextId})]),nextId:e.nextId+1};case _e.REMOVE:var a=Object(C.findIndex)(e.feedbacks,function(e){return e.id===t.data.id});return-1===a?e:Object(O.a)({},e,{feedbacks:[].concat(Object(Ce.a)(e.feedbacks.slice(0,a)),Object(Ce.a)(e.feedbacks.slice(a+1)))});case _e.SET:return Object(O.a)({},e,{feedbacks:t.data});default:return e}};function Ge(e){var t=r.a.useReducer(He,qe),a=Object(s.a)(t,2),n=a[0],c=a[1];return console.log("======> Updating feedback context"),r.a.createElement(Be.Provider,{value:{feedbacks:n.feedbacks,setFeedbacks:function(e){console.log(" ---\x3e SetFeedbacks "),c({type:_e.SET,data:e})},pushFeedback:function(e){console.log(" ---\x3e pushFeedback "),c({type:_e.ADD,data:e,dispatch:c}),n.feedbacks.push(e)}}},e.children,r.a.createElement(Be.Consumer,null,function(e){var t=e.feedbacks;e.setFeedbacks;return r.a.createElement(Le,{open:!!t.length,alerts:t.map(function(e,t){return Object(O.a)({},e,{onClose:function(){return c({type:_e.REMOVE,data:e})}})})})}))}var Je=a(30),Ke=a(288),Ve=a(37),Ye=function(){var e=window.localStorage.getItem("iofogUser");return e&&(Ve.user=JSON.parse(e)),Object(O.a)({},Ve,{api:"".concat(window.location.protocol,"//").concat(Ve.ip,":").concat(Ve.port||80,"/"),location:{lat:"Unknown",lon:"Unknown",query:Ve.ip}})}(),Qe=function(e){return Ve.dev?"/api/controllerApi".concat(e):"".concat(window.location.protocol,"//").concat([window.location.hostname,Ve.port].join(":")).concat(e)},Xe=function(e,t){return Ve.dev?Object(O.a)({},e,{"ECN-Api-Destination":t.api}):e},Ze=r.a.createContext({controller:{},updateController:function(){}}),$e=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n,r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.ip||(t.ip=window.location.host.split(":")[0]),a=new RegExp("(0.0.0.0|localhost|127.0.0.1|192.168.)"),n=a.test(t.ip)?"8.8.8.8":t.ip,e.next=5,window.fetch("http://ip-api.com/json/"+n);case 5:if(!(r=e.sent).ok){e.next=10;break}return e.abrupt("return",r.json());case 10:throw new Error(r.statusText);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=Object(j.a)(k.a.mark(function e(t){var a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.prev=1,e.next=4,$e(t);case 4:a=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),a={lat:"Unknown",lon:"Unknown",query:t.ip};case 10:return e.abrupt("return",Object(O.a)({},t,{location:a}));case 11:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),tt={controller:Ye,token:null},at={ERROR:"Error",CLEAN_ERROR:"Clean error",UPDATE:"Update",SET_TOKEN:"Set token"},nt=function(e,t){console.log({state:e,action:t});var a=function(){switch(t.type){case at.ERROR:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,{error:t.data})});case at.CLEAN_ERROR:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,{error:null})});case at.UPDATE:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,t.data)});case at.SET_TOKEN:return Object(O.a)({},e,{token:t.data,controller:Object(O.a)({},e.controller,{error:null})});default:return e}}();return a.controller.dev=Ve.dev,a};function rt(e){var t=r.a.useReducer(nt,tt),a=Object(s.a)(t,2),c=a[0],o=a[1],l=c.token,i=c.controller,u=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(Qe("/api/v3/user/login"),{method:"POST",headers:Xe({Accept:"application/json","Content-Type":"application/json"},t),body:JSON.stringify(t.user)});case 2:if(!(a=e.sent).ok){e.next=11;break}return e.next=6,a.json();case 6:return n=e.sent.accessToken,o({type:at.SET_TOKEN,data:n}),e.abrupt("return",n);case 11:throw o({type:at.SET_TOKEN,data:null}),new Error(a.statusText);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n,r,s=arguments;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>1&&void 0!==s[1]?s[1]:{},e.prev=1,n=l){e.next=7;break}return e.next=6,u(i);case 6:n=e.sent;case 7:return e.next=9,window.fetch(Qe(t),Object(O.a)({},a,{headers:Xe(Object(O.a)({},a.headers,{Authorization:n}),i)}));case 9:return r=e.sent,c.controller.error&&o({type:at.CLEAN_ERROR}),e.abrupt("return",r);case 14:return e.prev=14,e.t0=e.catch(1),o({type:at.ERROR,data:e.t0}),e.abrupt("return",{ok:!1,statusText:e.t0.message||"Could not reach controller"});case 18:case"end":return e.stop()}},e,null,[[1,14]])}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(j.a)(k.a.mark(function e(t){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ve.dev&&(t.api="http://".concat(t.ip,":").concat(t.port||80,"/")),window.localStorage.setItem("iofogUser",JSON.stringify(t.user)),e.prev=2,e.next=5,u(t);case 5:e.next=18;break;case 7:return e.prev=7,e.t0=e.catch(2),o({type:at.ERROR,data:e.t0}),e.t1=o,e.t2=at.UPDATE,e.next=14,et(t);case 14:throw e.t3=e.sent,e.t4={type:e.t2,data:e.t3},(0,e.t1)(e.t4),e.t0;case 18:return e.t5=o,e.t6=at.UPDATE,e.next=22,et(t);case 22:e.t7=e.sent,e.t8={type:e.t6,data:e.t7},(0,e.t5)(e.t8);case 25:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){return Object(j.a)(k.a.mark(function e(){return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(tt.controller);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),o({type:at.ERROR,data:e.t0});case 8:return e.t1=o,e.t2=at.UPDATE,e.next=12,et(tt.controller);case 12:e.t3=e.sent,e.t4={type:e.t2,data:e.t3},(0,e.t1)(e.t4);case 15:case"end":return e.stop()}},e,null,[[0,5]])}))()},[]),r.a.createElement(Ze.Provider,{value:{controller:i,updateController:p,request:m}},e.children)}var ct=Object(T.a)({divider:{margin:"5px"}}),ot={name:"",ip:"",key:"",port:54321},lt=function(e){return{message:e}};function st(e){var t=ct(),a=r.a.useState(Object(O.a)({},ot)),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useContext(Be).pushFeedback,i=r.a.useContext(Ze).request,u=function(e){return function(t){o(Object(O.a)({},c,Object(Je.a)({},e,t.target.value)))}},m=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("/api/v3/iofog",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});case 2:if(!(a=e.sent).ok){e.next=9;break}return l({message:"ioFog created!",type:"success"}),e.next=7,a.json();case 7:return n=e.sent,e.abrupt("return",n.uuid);case 9:throw lt("Failed to create iofog: ".concat(a.statusText));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("/api/v3/iofog/".concat(t,"/provisioning-key"));case 2:if(!(a=e.sent).ok){e.next=8;break}return e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n.key);case 8:throw lt("Failed to retrieve provisioning key: ".concat(a.statusText));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(j.a)(k.a.mark(function e(t,a){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch("api/agentApi/v2/config",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t.key,ioFogApi:"http://".concat(t.ip,":").concat(t.port)},body:JSON.stringify({"controller-url":"http://".concat(a.ip,":").concat(a.port,"/api/v3/")})});case 2:if(!(n=e.sent).ok){e.next=6;break}return l({message:"Agent linked!",type:"success"}),e.abrupt("return",!0);case 6:throw lt("Failed to link agent: ".concat(n.statusText));case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),f=function(){var e=Object(j.a)(k.a.mark(function e(t,a){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch("api/agentApi/v2/provision",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t.key,ioFogApi:"http://".concat(t.ip,":").concat(t.port)},body:JSON.stringify({"provisioning-key":a})});case 2:if(!(n=e.sent).ok){e.next=6;break}return l({message:"Agent provisioned!",type:"success"}),e.abrupt("return",!0);case 6:throw lt("Failed to provision agent: ".concat(n.statusText));case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),g=function(){var t=Object(j.a)(k.a.mark(function t(){var a,n;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m({name:c.name,fogType:0});case 3:return a=t.sent,t.next=6,p(a);case 6:return n=t.sent,t.next=9,d(c,e.controller);case 9:return t.next=11,f(c,n);case 11:l({message:"Agent connected!",type:"success"}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),l({message:t.t0.message,type:"error",uuid:"error"});case 17:case"end":return t.stop()}},t,null,[[0,14]])}));return function(){return t.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"name",label:"Name",onChange:u("name"),value:c.name,fullWidth:!0,className:t.textField,margin:"normal"})),r.a.createElement(ke.a,{item:!0,xs:6,sm:3},r.a.createElement(Ke.a,{id:"ip",label:"IP",onChange:u("ip"),value:c.ip,fullWidth:!0,className:t.textField,margin:"normal"})),r.a.createElement(ke.a,{item:!0,xs:6,sm:3},r.a.createElement(Ke.a,{id:"port",label:"Port",onChange:u("port"),value:c.port,fullWidth:!0,type:"number",className:t.textField,margin:"normal"})),r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(Ke.a,{id:"key",label:"Authorization key",onChange:u("key"),value:c.key,fullWidth:!0,className:t.textField,margin:"normal",helperText:"Authorization key can be found in /etc/iofog-agent/local-api file"}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,justify:"flex-end"},r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{onClick:g},"Connect"))))}var it=a(49),ut=a.n(it),mt=a(276),pt=a(278),dt=a(286),ft=a(290),gt=a(287),bt=a(120),vt=a.n(bt),ht=a(91),Et=a(135),xt=a(119),yt=a.n(xt),wt=Object(De.a)(function(e){return{root:{flexGrow:1,height:250},container:{flexGrow:1,position:"relative"},paper:{position:"absolute",zIndex:1,marginTop:e.spacing(1),marginBot:e.spacing(2),left:0,right:0,maxHeight:"250px",overflowY:"scroll"},chip:{margin:e.spacing(.5,.25)},inputRoot:{flexWrap:"wrap"},inputInput:{width:"auto",flexGrow:1},divider:{height:e.spacing(2)}}});function kt(e){var t=wt();return r.a.createElement(Et.a,Object.assign({itemToString:function(e){return ut()(e,"label","")},onChange:e.onChange,initialSelectedItem:e.initialSelectedItem},e.selectedItem?{selectedItem:e.selectedItem}:{},{id:"downshift-options"}),function(a){var n=a.clearSelection,c=a.getInputProps,o=a.getItemProps,l=a.getLabelProps,s=a.getMenuProps,i=a.highlightedIndex,u=a.inputValue,m=a.isOpen,p=a.openMenu,d=a.selectedItem,f=c({onChange:function(e){""===e.target.value&&n()},onFocus:p,disabled:e.disabled||!1,placeholder:e.placeholder||""}),g=f.onBlur,b=f.onChange,v=f.onFocus,h=Object(ht.a)(f,["onBlur","onChange","onFocus"]);return r.a.createElement("div",{className:t.container},function(e){var t=e.InputProps,a=e.classes,n=e.ref,c=Object(ht.a)(e,["InputProps","classes","ref"]);return r.a.createElement(Ke.a,Object.assign({InputProps:Object(O.a)({inputRef:n,classes:{root:a.inputRoot,input:a.inputInput}},t)},c))}({fullWidth:!0,classes:t,label:e.label,InputLabelProps:l({shrink:!0}),InputProps:{onBlur:g,onChange:b,onFocus:v},inputProps:h}),r.a.createElement("div",s(),m?r.a.createElement(Q.a,{className:t.paper,square:!0},function(t){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).showEmpty,n=void 0!==a&&a,r=yt()(t.trim()).toLowerCase(),c=r.length,o=0;return 0!==c||n?e.suggestions.filter(function(t){var a=o<e.maxSuggestions&&t.label.toLowerCase().startsWith(r.toLowerCase());return a&&(o+=1),a}):[]}(u,{showEmpty:!0}).map(function(e,t){return function(e){var t=e.suggestion,a=e.index,n=e.itemProps,c=e.highlightedIndex===a,o=(e.selectedItem||{}).label===t.label;return r.a.createElement(re.a,Object.assign({},n,{key:t.label,selected:c,component:"div",style:{fontWeight:o?500:400}}),t.label)}({suggestion:e,index:t,itemProps:o({item:e}),highlightedIndex:i,selectedItem:d})})):null))})}var jt=Object(T.a)({divider:{margin:"5px"},formControl:{width:"100%"},rowIcon:{display:"flex",justifyContent:"space-around"},newPaper:{border:"1px solid hsla(0, 0%, 0%, 0.2)",boxShadow:"0 4px 6px 0 hsla(0,0%,0%,0.2)",borderRadius:"4px",padding:"10px",marginTop:"10px"},inputWithIcon:{display:"flex",alignItems:"baseline",justifyContent:"space-between"}}),Ot={PaperProps:{style:{maxHeight:224,width:250}}},Ct={flow:{},name:"",catalog:{images:[]},volumeMappings:[],ports:[],rootHostAccess:!1,_new:!0},Nt={name:"",isActivated:!0},Tt=function(e){return{name:"",images:[{containerImage:"",fogTypeId:e}],registryId:1}},St=function(e){return{from:e,to:{}}},It=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},At=function(e,t,a,n){var c=ut()(e,"_new",!1);return r.a.createElement(kt,{label:a,placeholder:"Select a microservice",onChange:n,disabled:c,selectedItem:c?t[t.length-1]:e,maxSuggestions:20,suggestions:t.filter(function(e){return!!c||!!e.uuid}).map(function(e){return Object(O.a)({},e,{label:e.name})})})};function Ft(e){var t=jt(),a=r.a.useState([]),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useState([]),i=Object(s.a)(l,2),u=i[0],m=i[1],p=r.a.useRef({}),d=r.a.useRef(r.a.createElement(ee.a,{src:p.current,name:!1,onAdd:function(e){p.current=e.updated_src},onEdit:function(e){p.current=e.updated_src},onDelete:function(e){p.current=e.updated_src}})),f=r.a.useState(Ct),g=Object(s.a)(f,2),b=g[0],v=g[1],h=r.a.useState(Nt),E=Object(s.a)(h,2),x=E[0],y=E[1],w=r.a.useState(function(){return Tt(ut()(e,"target.fogTypeId",1))}),C=Object(s.a)(w,2),T=C[0],S=C[1],I=r.a.useState([]),R=Object(s.a)(I,2),P=R[0],M=R[1],D=e.target,U=r.a.useContext(Be).pushFeedback,W=r.a.useContext(Ze).request;r.a.useEffect(function(){Promise.all([Object(j.a)(k.a.mark(function e(){var t,a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W("/api/v3/flow");case 2:if(!(t=e.sent).ok){e.next=8;break}return e.next=6,t.json();case 6:a=e.sent,o(a.flows);case 8:case"end":return e.stop()}},e)}))(),Object(j.a)(k.a.mark(function e(){var t,a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W("/api/v3/catalog/microservices");case 2:if(!(t=e.sent).ok){e.next=8;break}return e.next=6,t.json();case 6:a=e.sent,m(a.catalogItems.filter(function(e){var t=!0,a=!1,n=void 0;try{for(var r,c=e.images[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){if(r.value.fogTypeId===D.fogTypeId)return!0}}catch(o){a=!0,n=o}finally{try{t||null==c.return||c.return()}finally{if(a)throw n}}return!1}));case 8:case"end":return e.stop()}},e)}))()])},[D.fogTypeId,W]);var z=function(e,t,a){return function(n){return t(Object(O.a)({},a,Object(Je.a)({},e,n.target.value)))}},L=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e};return function(r){return v(Object(O.a)({},b,Object(Je.a)({},e,[].concat(Object(Ce.a)(b[e].slice(0,a)),[Object(O.a)({},b[e][a],Object(Je.a)({},t,n(r.target.value)))],Object(Ce.a)(b[e].slice(a+1))))))}},B=function(e){if(!ut()(e,"id",null))return"Select an image";var t=!0,a=!1,n=void 0;try{for(var r,c=e.images[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){var o=r.value;if(o.fogTypeId===D.fogTypeId)return o.containerImage}}catch(l){a=!0,n=l}finally{try{t||null==c.return||c.return()}finally{if(a)throw n}}return"Image not found"},_=function(e,t){return v(Object(O.a)({},b,Object(Je.a)({},e,[].concat(Object(Ce.a)(b[e].slice(0,t)),Object(Ce.a)(b[e].slice(t+1))))))},q=function(){var e=Object(j.a)(k.a.mark(function e(){var t,a,n,r,c,o;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=b.name,a=b.ports,n=b.volumeMappings,r=b.rootHostAccess,e.next=4,W("/api/v3/microservices",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({config:JSON.stringify(p.current),name:t,ports:a,volumeMappings:n,rootHostAccess:r,flowId:b.flow.id,iofogUuid:D.uuid,catalogItemId:b.catalog.id})});case 4:if(!(c=e.sent).ok){e.next=14;break}return U({message:"Microservice added!",type:"success"}),e.next=9,c.json();case 9:return o=e.sent,v(Ct),e.abrupt("return",o.uuid);case 14:U({message:c.statusText,type:"error"});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),U({message:e.t0.message});case 20:case"end":return e.stop()}},e,null,[[0,17]])}));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(j.a)(k.a.mark(function e(){var t,a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=x.name,e.next=4,W("/api/v3/flow",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(x)});case 4:if(!(a=e.sent).ok){e.next=20;break}return U({message:"Flow created!",type:"success"}),y(Nt),e.t0=O.a,e.t1={},e.next=12,a.json();case 12:return e.t2=e.sent,e.t3={name:t},n=(0,e.t0)(e.t1,e.t2,e.t3),v(Object(O.a)({},b,{flow:n})),b.flow=n,e.abrupt("return",!0);case 20:return U({message:a.statusText,type:"error"}),e.abrupt("return",!1);case 22:e.next=28;break;case 24:return e.prev=24,e.t4=e.catch(0),U({message:e.t4.message}),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,null,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(j.a)(k.a.mark(function e(){var t,a,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Object(O.a)({},T,{name:It()}),e.next=4,W("/api/v3/catalog/microservices",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});case 4:if(!(a=e.sent).ok){e.next=20;break}return U({message:"Image added to catalog!",type:"success"}),S(Tt(D.fogTypeId)),e.t0=O.a,e.t1={},e.next=12,a.json();case 12:return e.t2=e.sent,e.t3=t,n=(0,e.t0)(e.t1,e.t2,e.t3),v(Object(O.a)({},b,{catalog:n})),b.catalog=n,e.abrupt("return",!0);case 20:return U({message:a.statusText,type:"error"}),e.abrupt("return",!1);case 22:e.next=28;break;case 24:return e.prev=24,e.t4=e.catch(0),U({message:e.t4.message}),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,null,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),J=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n,r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=ut()(t,"from.uuid"),n=ut()(t,"to.uuid"),e.next=5,W("/api/v3//microservices/".concat(a,"/routes/").concat(n),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:""});case 5:if(!(r=e.sent).ok){e.next=11;break}return U({message:"Route from ".concat(t.from.name," to ").concat(t.to.name," created !"),type:"success"}),e.abrupt("return",!0);case 11:return U({message:r.statusText,type:"error"}),e.abrupt("return",!1);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),U({message:e.t0.message}),e.abrupt("return",!1);case 19:case"end":return e.stop()}},e,null,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(j.a)(k.a.mark(function e(t){var a,n,r,c,o,l;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!0,n=!1,r=void 0,e.prev=3,c=P[Symbol.iterator]();case 5:if(a=(o=c.next()).done){e.next=14;break}return(l=o.value).from.uuid||(l.from.uuid=t),l.to.uuid||(l.to.uuid=t),e.next=11,J(l);case 11:a=!0,e.next=5;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),n=!0,r=e.t0;case 20:e.prev=20,e.prev=21,a||null==c.return||c.return();case 23:if(e.prev=23,!n){e.next=26;break}throw r;case 26:return e.finish(23);case 27:return e.finish(20);case 28:case"end":return e.stop()}},e,null,[[3,16,20,28],[21,,23,27]])}));return function(t){return e.apply(this,arguments)}}(),V=function(){var t=Object(j.a)(k.a.mark(function t(){var a,n;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=!0,t.prev=1,-1!==b.flow.id){t.next=6;break}return t.next=5,H();case 5:a=t.sent;case 6:if(!a||-1!==b.catalog.id){t.next=10;break}return t.next=9,G();case 9:a=t.sent;case 10:if(!a){t.next=17;break}return t.next=13,q();case 13:return n=t.sent,t.next=16,K(n);case 16:e.onSuccess();case 17:t.next=21;break;case 19:t.prev=19,t.t0=t.catch(1);case 21:case"end":return t.stop()}},t,null,[[1,19]])}));return function(){return t.apply(this,arguments)}}(),Y=(e.microservices||[]).map(function(e){return Object(O.a)({},e,{label:e.name})}).concat([Object(O.a)({},b,{label:b.name?b.name:"<New microservice>"})]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(mt.a,{className:t.formControl},r.a.createElement(kt,{label:"Flow",placeholder:"Select a flow",onChange:function(e,t){z("flow",v,b)({target:{value:e||{}}})},maxSuggestions:20,suggestions:c.map(function(e){return Object(O.a)({},e,{label:e.name})}).concat([{id:-1,label:"+ Add a flow"}])})),-1===b.flow.id&&r.a.createElement(Q.a,{className:t.newPaper},r.a.createElement(A.a,{variant:"subtitle2"},"New flow"),r.a.createElement(Ke.a,{id:"name",label:"Name",required:!0,onChange:z("name",y,x),value:x.name,fullWidth:!0,className:t.textField,margin:"normal"}),r.a.createElement(pt.a,{style:{color:"rgba(0, 0, 0, 0.54)"},control:r.a.createElement(dt.a,{checked:x.isActivated,onChange:function(e){return y(Object(O.a)({},x,{isActivated:e.target.checked}))},value:"checkedB",color:"primary"}),label:"Active"}))),r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(mt.a,{className:t.formControl},r.a.createElement(kt,{label:"Image",placeholder:"Select an image",onChange:function(e,t){z("catalog",v,b)({target:{value:e||{}}})},maxSuggestions:20,suggestions:u.map(function(e){return Object(O.a)({},e,{label:B(e)})}).concat([{id:-1,label:"+ Add an image"}])})),-1===b.catalog.id&&r.a.createElement(Q.a,{className:t.newPaper},r.a.createElement(A.a,{variant:"subtitle2"},"New image"),r.a.createElement(Ke.a,{id:"name",label:"Name",required:!0,onChange:function(e){return S(Object(O.a)({},T,{images:[Object(O.a)({},T.images[0],{containerImage:e.target.value})]}))},value:T.images[0].containerImage,fullWidth:!0,className:t.textField,margin:"normal"})))),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(Ke.a,{id:"name",label:"Name",required:!0,onChange:z("name",v,b),value:b.name,fullWidth:!0,className:t.textField,margin:"normal"}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Configuration"),r.a.createElement("br",null),d.current)),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Volumes"),r.a.createElement("br",null),b.volumeMappings.map(function(e,a){return r.a.createElement(ke.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(ke.a,{item:!0,xs:11},r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:4},r.a.createElement(Ke.a,{id:"host",label:"Host",required:!0,onChange:L("volumeMappings","hostDestination",a),value:e.hostDestination,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(ke.a,{item:!0,xs:12,sm:4},r.a.createElement(Ke.a,{id:"Container",label:"Container",required:!0,onChange:L("volumeMappings","containerDestination",a),value:e.containerDestination,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(ke.a,{item:!0,xs:12,sm:4},r.a.createElement(mt.a,{className:t.formControl,style:{marginTop:"5px"}},r.a.createElement(ft.a,{htmlFor:"select-flow"},"Access mode"),r.a.createElement(gt.a,{required:!0,value:e.accessMode,onChange:L("volumeMappings","accessMode",a),input:r.a.createElement(F.a,{id:"select-flow-input"}),MenuProps:Ot},r.a.createElement(re.a,{value:"z"},"Z")))))),r.a.createElement(ke.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(xe.a,{style:{cursor:"pointer"},onClick:function(){return _("volumeMappings",a)}})))}),r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return v(Object(O.a)({},b,{volumeMappings:[].concat(Object(Ce.a)(b.volumeMappings),[{hostDestination:"",containerDestination:"",accessMode:"z"}])}))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Ports"),r.a.createElement("br",null),b.ports.map(function(e,a){return r.a.createElement(ke.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(ke.a,{item:!0,xs:11},r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"host",label:"External",required:!0,type:"number",onChange:L("ports","external",a,parseInt),value:e.external,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"Container",label:"Internal",required:!0,fullWidth:!0,type:"number",onChange:L("ports","internal",a,parseInt),value:e.internal,className:t.textField,margin:"dense"})))),r.a.createElement(ke.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(xe.a,{style:{cursor:"pointer"},onClick:function(){return _("ports",a)}})))}),r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return v(Object(O.a)({},b,{ports:[].concat(Object(Ce.a)(b.ports),[{internal:"",external:""}])}))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12},r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Routes"),r.a.createElement("br",null),P.map(function(e,a){return r.a.createElement(ke.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(ke.a,{item:!0,xs:11},r.a.createElement(ke.a,{container:!0,spacing:2,style:{alignItems:"flex-end"}},r.a.createElement(ke.a,{item:!0,xs:12,sm:5},At(e.from,Y,"From",function(t){return M([].concat(Object(Ce.a)(P.slice(0,a)),[Object(O.a)({},e,{from:t||{}})],Object(Ce.a)(P.slice(a+1))))})),r.a.createElement(ke.a,{item:!0,xs:2,className:t.rowIcon},r.a.createElement(vt.a,{style:{cursor:"pointer"},onClick:function(){return M([].concat(Object(Ce.a)(P.slice(0,a)),[Object(O.a)({},e,{from:e.to,to:e.from})],Object(Ce.a)(P.slice(a+1))))}})),r.a.createElement(ke.a,{item:!0,xs:12,sm:5},At(e.to,Y,"To",function(t){return M([].concat(Object(Ce.a)(P.slice(0,a)),[Object(O.a)({},e,{to:t||{}})],Object(Ce.a)(P.slice(a+1))))})))),r.a.createElement(ke.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(xe.a,{style:{cursor:"pointer"},onClick:function(){return M([].concat(Object(Ce.a)(P.slice(0,a)),Object(Ce.a)(P.slice(a+1))))}})))}),r.a.createElement(A.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return M([].concat(Object(Ce.a)(P),[St(b)]))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(pt.a,{style:{color:"rgba(0, 0, 0, 0.54)"},control:r.a.createElement(dt.a,{checked:b.rootHostAccess,onChange:function(e){return v(Object(O.a)({},b,{rootHostAccess:e.target.checked}))},value:"checkedB",color:"primary"}),label:"Root host access"}),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,justify:"flex-end"},r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{onClick:V},"Add"))))}var Rt=Object(T.a)({chips:{display:"flex",flexWrap:"wrap"},chip:{margin:2},formControl:{width:"100%",marginBottom:"15px"},divider:{margin:"5px"}}),Pt={PaperProps:{style:{maxHeight:224,width:250}}};function Mt(e){var t=Rt(),a=r.a.useState([]),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useContext(Be).pushFeedback,i=r.a.useContext(Ze).request;var u=function(){var t=Object(j.a)(k.a.mark(function t(){var a,n,r,s,u,m,d,f,g;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,a=!0,n=!0,r=!1,s=void 0,t.prev=5,u=c[Symbol.iterator]();!(n=(m=u.next()).done);n=!0)d=m.value,(f=i("/api/v3/microservices/".concat(d),{method:"DELETE"})).ok?(g=c.indexOf(d),o([].concat(Object(Ce.a)(c.slice(0,g)),Object(Ce.a)(c.slice(g+1))))):(a=!1,l({message:"".concat(p[d].name,": ").concat(f.statusText),type:"error",uuid:d}));t.next=13;break;case 9:t.prev=9,t.t0=t.catch(5),r=!0,s=t.t0;case 13:t.prev=13,t.prev=14,n||null==u.return||u.return();case 16:if(t.prev=16,!r){t.next=19;break}throw s;case 19:return t.finish(16);case 20:return t.finish(13);case 21:a&&(l({message:"Microservices removed",type:"success",uuid:"success"}),e.onSuccess()),t.next=27;break;case 24:t.prev=24,t.t1=t.catch(0),l({message:t.t1.message,type:"error",uuid:"error"});case 27:case"end":return t.stop()}},t,null,[[0,24],[5,9,13,21],[14,,16,20]])}));return function(){return t.apply(this,arguments)}}(),m=e.msvcs,p=m.reduce(function(e,t){return Object(O.a)({},e,Object(Je.a)({},t.uuid,t))},{});return r.a.createElement(r.a.Fragment,null,r.a.createElement(mt.a,{className:t.formControl},r.a.createElement(ft.a,{htmlFor:"select-multiple-checkbox"},"Microservices to remove"),r.a.createElement(gt.a,{multiple:!0,value:c,onChange:function(e){o(e.target.value)},input:r.a.createElement(F.a,{id:"select-multiple-checkbox-rm-msvcs"}),renderValue:function(e){return r.a.createElement("div",{className:t.chips},e.map(function(e){return p[e]&&r.a.createElement(P.a,{key:e,label:p[e].name,className:t.chip})}))},MenuProps:Pt},m.map(function(e){return r.a.createElement(re.a,{key:e.uuid,value:e.uuid},r.a.createElement(dt.a,{checked:c.indexOf(e.uuid)>-1}),r.a.createElement(W.a,{primary:e.name}))}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(ke.a,{container:!0,justify:"flex-end"},r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{onClick:u},"Remove"))))}var Dt=a(284),Ut=a(279);function Wt(e){return r.a.createElement(A.a,{component:"div",style:{padding:24}},e.children)}var zt=Object(De.a)(function(e){return{root:{flexGrow:1,backgroundColor:e.palette.background.paper}}});function Lt(e){var t=zt(),a=r.a.useState(0),n=Object(s.a)(a,2),c=n[0],o=n[1];return r.a.createElement("div",{className:t.root},r.a.createElement(Dt.a,{value:c,onChange:function(e,t){o(t)}},e.children.map(function(e){return r.a.createElement(Ut.a,{label:e.props.title})})),r.a.createElement(Wt,null,e.children[c]))}var Bt=Object(T.a)(function(e){return{avatarList:{color:"white",backgroundColor:"var(--statusColor, white)",boxShadow:"0px 2px 2px ".concat(e.colors.carbon)},msvcChipList:{display:"flex",flexDirection:"column",width:"20%",flex:"1",paddingRight:"15px"},msvcChip:{marginTop:"var(--mTop, 0px)",backgroundColor:"var(--color, ".concat(e.colors.cobalt,")"),fontSize:"10px",borderRadius:"5px",height:"20px",margin:"2px",width:"100px",color:"white","& .MuiChip-label":{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",display:"block"}},jsonDisplay:{width:"99%",minHeight:"30rem",fontFamily:'"Lucida Console", Monaco, monospace',fontSize:"0.8rem",lineHeight:"1.2"},listTitle:{display:"flex",justifyContent:"space-between",alignItems:"baseline",color:e.palette.text.primary},link:{color:e.palette.text.secondary,cursor:"pointer","&:hover":{textDecoration:"underline"}}}});function _t(e){var t=Bt(),a=r.a.useState(!1),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useState(!1),i=Object(s.a)(l,2),u=i[0],p=i[1],d=r.a.useState(!1),f=Object(s.a)(d,2),g=f[0],b=f[1],v=r.a.useState(!1),h=Object(s.a)(v,2),E=h[0],x=h[1],y=r.a.useState(!1),w=Object(s.a)(y,2),O=w[0],C=w[1],N=r.a.useState(null),T=Object(s.a)(N,2),S=T[0],I=T[1],F=e.msvcsPerAgent,R=e.msvcs,U=e.agents,z=e.agent,L=e.setAgent,B=e.setAutozoom,_=e.loading,q=r.a.useContext(Be),H=r.a.useContext(Ze).request,G=function(){return I(null)},J=function(e){return I(e.currentTarget)},K=function(){var e=Object(j.a)(k.a.mark(function e(t){var a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H("/api/v3/iofog/".concat(t.uuid),{method:"DELETE"});case 3:(a=e.sent).ok?q.pushFeedback({message:"Agent removed!",type:"success"}):q.pushFeedback({message:"Failed to remove node: ".concat(a.statusText),type:"error"}),o(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),q.pushFeedback({message:e.t0.message,type:"error"});case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(M.a,{subheader:r.a.createElement(te.a,{component:"div",id:"agent-list-subheader",style:{position:"relative"},disableGutters:!0,disableSticky:!0},r.a.createElement("div",{className:t.listTitle},r.a.createElement("div",null,r.a.createElement(A.a,{variant:"h5"},"Agents - ",r.a.createElement("small",null,_?0:U.length," nodes"))),r.a.createElement("div",null,r.a.createElement("small",{className:t.link,onClick:function(){return B(!0)}},"See all ECN"))))},(_?[]:U).map(function(e){var a=F[e.uuid]||[];return r.a.createElement(D.a,{button:!0,key:e.uuid,onClick:function(){return L(e)},selected:e.uuid===z.uuid},r.a.createElement(ae.a,null,r.a.createElement(m.a,{style:{"--statusColor":ge[e.daemonStatus]},className:t.avatarList},r.a.createElement(se.a,null))),r.a.createElement(W.a,{primary:e.name,secondary:"".concat(a.length," Microservices")}),r.a.createElement("div",{className:t.msvcChipList},a.map(function(a,n){return r.a.createElement(r.a.Fragment,{key:a.uuid},r.a.createElement(P.a,{size:"small",label:a.name,style:{"--mTop":n?"2px":"0px","--color":be["RUNNING"===e.daemonStatus&&a.flowActive?"RUNNING":"UNKNOWN"]},className:t.msvcChip,title:a.name}))})),r.a.createElement(oe.a,{onClick:J}))})),r.a.createElement(we,{open:u,title:"".concat(z.name," details"),onClose:function(){return p(!1)}},r.a.createElement(Lt,null,r.a.createElement(ee.a,{title:"Agent",src:z,name:!1}),r.a.createElement(ee.a,{title:"Microservices",src:F[z.uuid],name:!1}))),r.a.createElement(we,{open:E,title:"Deploy microservice to ".concat(z.name),onClose:function(){return x(!1)}},r.a.createElement(Ft,{target:z,microservices:R,onSuccess:function(){return x(!1)}})),r.a.createElement(we,{open:O,title:"Remove microservice from ".concat(z.name),onClose:function(){return C(!1)}},r.a.createElement(Mt,{target:z,msvcs:F[z.uuid]||[],onSuccess:function(){return C(!1)}})),r.a.createElement(we,{open:g,title:"Connect agent",onClose:function(){return b(!1)}},r.a.createElement(st,{controller:e.controller,onSuccess:function(){return b(!1)}})),r.a.createElement(Oe,{open:c,title:"Remove agent: ".concat(z.name),onClose:function(){return o(!1)},onConfirm:function(){return K(z)}},r.a.createElement(A.a,{variant:"h5"},"Confirm removal of agent UUID: ",z.uuid)),r.a.createElement(ne.a,{id:"agent-menu",anchorEl:S,keepMounted:!0,open:Boolean(S),onClose:G},r.a.createElement(re.a,{onClick:function(){p(!0),G()}},"Details")))}var qt=a(122),Ht=a.n(qt),Gt=a(123),Jt=a(282),Kt=a(124),Vt=a.n(Kt),Yt=Object(T.a)(function(e){return{mapMarkerTransform:{transform:"translate(-50%, -100%)",position:"absolute"},msvcBadge:{"& .MuiBadge-badge":{backgroundColor:"var(--color, ".concat(e.colors.cobalt,")")}},mapMarker:{backgroundColor:"var(--markerColor, ".concat(e.colors.success,")"),borderRadius:"50% 50% 50% 0 !important",border:"2px solid var(--markerColor, ".concat(e.colors.success,")"),transform:"rotate(-45deg)","& .MuiSvgIcon-root":{transform:"rotate(-45deg)"}},mapWrapper:{boxShadow:"0px 1px 3px 0px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 2px 1px -1px rgba(0,0,0,0.12)",borderRadius:"4px",width:"100%",height:"100%",maxHeight:"700px",position:"sticky",top:"25px",borderColor:e.colors.aluminium,"& div":{borderRadius:"4px","& div":{borderRadius:"4px"}}}}}),Qt=function(e){return Object(C.isFinite)(e[0])&&Object(C.isFinite)(e[1])};function Xt(e){var t=Yt(),a=Object(G.a)(),n=r.a.useRef(),c=e.controller,o=e.agent,l=e.setAgent,s=e.msvcsPerAgent,i=e.map,u=e.autozoom,p=e.loading;return u&&window.google&&function(){var e=new window.google.maps.LatLngBounds,t=(c.agents||[]).filter(function(e){return Qt([e.latitude,e.longitude])});if(!t.length)return i.center=[Object(C.get)(c,"info.location.lat",0),Object(C.get)(c,"info.location.lon",0)],void(i.zoom=9);t.forEach(function(t){e.extend(new window.google.maps.LatLng(Object(C.get)(t,"latitude",0),Object(C.get)(t,"longitude",0)))}),e.extend(new window.google.maps.LatLng(Object(C.get)(c,"info.location.lat",0),Object(C.get)(c,"info.location.lon",0)));var a={ne:{lat:e.getNorthEast().lat(),lng:e.getNorthEast().lng()},sw:{lat:e.getSouthWest().lat(),lng:e.getSouthWest().lng()}},r={width:Object(C.get)(n,"current.offsetWidth",600),height:Object(C.get)(n,"current.offsetHeight",800)},o=Object(Gt.fitBounds)(a,r),l=o.center,s=o.zoom;i.center=l,i.zoom=s}(),r.a.createElement("div",{className:t.mapWrapper,ref:n},r.a.createElement(Ht.a,Object.assign({},i,{bootstrapURLKeys:{key:"AIzaSyChp_fUXiK05ulRl_ewRGKWsQ1k0ULIFkA"}}),(p?[]:c.agents).filter(function(e){return Qt([e.latitude,e.longitude])}).map(function(e){return r.a.createElement("div",{key:e.uuid,lat:e.latitude,lng:e.longitude,className:t.mapMarkerTransform,onClick:function(){return l(e)}},r.a.createElement(Jt.a,{color:"primary",style:{"--color":be[e.daemonStatus]},badgeContent:(s[e.uuid]||[]).filter(function(e){return e.flowActive}).length,invisible:e.uuid!==o.uuid,className:"".concat(t.msvcBadge)},r.a.createElement(m.a,{style:{"--markerColor":ge[e.daemonStatus]},className:t.mapMarker},r.a.createElement(se.a,null))))}),!p&&c.info&&Qt([c.info.location.lat,c.info.location.lon])&&r.a.createElement(m.a,{lat:c.info.location.lat,lng:c.info.location.lon,style:{"--markerColor":a.colors.argon},className:t.mapMarker},r.a.createElement(Vt.a,null))))}a(225);var Zt=a(125),$t=Object(T.a)({divider:{margin:"15px 0"}}),ea={controller:{info:{location:{},user:{}},agents:[],flows:[],microservices:[]},agent:{},activeAgents:[],activeFlows:[],activeMsvcs:[],msvcsPerAgent:[]},ta={UPDATE:"UPDATE",SET_AGENT:"SET_AGENT"},aa=function(e,t){switch(t.type){case ta.UPDATE:return function(e,t){if(!t)return e;var a=t.flows.filter(function(e){return!0===e.isActivated}),n=t.agents.filter(function(e){return"RUNNING"===e.daemonStatus}),r=Object(C.groupBy)(t.microservices.map(function(e){return Object(O.a)({},e,{flowActive:!!Object(C.find)(a,function(t){return e.flowId===t.id})})}),"iofogUuid"),c=n.reduce(function(e,t){return e.concat(Object(C.get)(r,t.uuid,[]).filter(function(e){return!!Object(C.find)(a,function(t){return t.id===e.flowId})})||[])},[]);return e.agent&&e.agent.uuid||(e.agent=t.agents[0]||{}),Object(O.a)({},e,{controller:t,activeFlows:a,activeAgents:n,activeMsvcs:c,msvcsPerAgent:r})}(e,t.data);case ta.SET_AGENT:return Object(O.a)({},e,{agent:t.data});default:return e}};function na(){var e=$t(),t=r.a.useReducer(aa,ea),a=Object(s.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(!0),i=Object(s.a)(l,2),u=i[0],m=i[1],p=Object(n.useState)(!0),d=Object(s.a)(p,2),f=d[0],g=d[1],b=Object(n.useState)(!1),v=Object(s.a)(b,2),h=v[0],E=v[1],x=Object(n.useState)({center:[0,0],zoom:15,options:{styles:Zt}}),y=Object(s.a)(x,2),w=y[0],T=y[1],S=r.a.useContext(Ze),I=S.controller,A=S.request;r.a.useEffect(function(){g(!0),E(null)},[I]);var F=function(){var e=Object(j.a)(k.a.mark(function e(){var t,a,n,r,c,l,s,i,u,m,p,d;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A("/api/v3/iofog-list");case 2:if((t=e.sent).ok){e.next=6;break}return E({message:t.statusText}),e.abrupt("return");case 6:return e.next=8,t.json();case 8:return a=e.sent.fogs,e.next=11,A("/api/v3/flow");case 11:if((n=e.sent).ok){e.next=15;break}return E({message:n.statusText}),e.abrupt("return");case 15:return e.next=17,n.json();case 17:r=e.sent.flows,c=[],l=!0,s=!1,i=void 0,e.prev=22,u=r[Symbol.iterator]();case 24:if(l=(m=u.next()).done){e.next=40;break}return p=m.value,e.next=28,A("/api/v3/microservices?flowId=".concat(p.id));case 28:if(d=e.sent,n.ok){e.next=32;break}return E({message:d.statusText}),e.abrupt("return");case 32:return e.t0=c,e.next=35,d.json();case 35:e.t1=e.sent.microservices,c=e.t0.concat.call(e.t0,e.t1);case 37:l=!0,e.next=24;break;case 40:e.next=46;break;case 42:e.prev=42,e.t2=e.catch(22),s=!0,i=e.t2;case 46:e.prev=46,e.prev=47,l||null==u.return||u.return();case 49:if(e.prev=49,!s){e.next=52;break}throw i;case 52:return e.finish(49);case 53:return e.finish(46);case 54:f&&g(!1),h&&E(!1),o({type:ta.UPDATE,data:{agents:a,flows:r,microservices:c}});case 57:case"end":return e.stop()}},e,null,[[22,42,46,54],[47,,49,53]])}));return function(){return e.apply(this,arguments)}}();!function(e,t){var a=Object(n.useRef)();Object(n.useEffect)(function(){a.current=e},[e]),Object(n.useEffect)(function(){if(null!==t){var e=setInterval(function(){a.current()},t);return function(){return clearInterval(e)}}},[t])}(function(){F()},[3e3]);var R=function(e){return o({type:ta.SET_AGENT,data:e})},P=c.controller,M=c.activeAgents,D=c.activeFlows,U=c.activeMsvcs,W=c.agent,z=c.msvcsPerAgent;return r.a.createElement("div",{className:"viewer-layout-container"},r.a.createElement("div",{className:"box sidebar"},r.a.createElement(Y,{controller:I,selectController:function(){T(Object(O.a)({},w,{center:[I.location.lat,I.location.lon],zoom:15})),m(!1)},loading:f,error:h}),r.a.createElement(N.a,{className:e.divider}),r.a.createElement(Z,{activeAgents:M,activeFlows:D,activeMsvcs:U,loading:f}),r.a.createElement(N.a,{className:e.divider}),r.a.createElement(_t,{msvcsPerAgent:z,loading:f,msvcs:P.microservices,agents:P.agents,agent:W,setAgent:function(e){R(e),Object(C.isFinite)(e.latitude)&&Object(C.isFinite)(e.longitude)&&(T(Object(O.a)({},w,{center:[e.latitude,e.longitude],zoom:15})),m(!1))},centerMap:function(e){T(Object(O.a)({},w,{center:e}))},setAutozoom:m,controller:P.info})),r.a.createElement("div",{className:"map-grid-container"},r.a.createElement(Xt,{controller:Object(O.a)({},P,{info:I}),agent:W,setAgent:R,msvcsPerAgent:z,map:w,autozoom:u,setAutozoom:m,loading:f})))}var ra=Object(T.a)({skeleton:{minHeight:"55px"}});function ca(e){var t=ra(),a=r.a.useContext(Be).pushFeedback,n=r.a.useContext(Ze),c=n.controller,o=n.updateController,l=r.a.useState(Object(O.a)({},c)),i=Object(s.a)(l,2),u=i[0],m=i[1],p=function(){var t=Object(j.a)(k.a.mark(function t(){return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o(u);case 3:a({message:u.dev?"Controller details saved!":"Authenticated!",type:"success"}),e.onSave(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a({message:t.t0.message,type:"error"});case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(){return t.apply(this,arguments)}}(),d=function(e){return function(t){m(Object(O.a)({},u,Object(Je.a)({},e,t.target.value)))}},f=function(e){return function(t){m(Object(O.a)({},u,{user:Object(O.a)({},u.user,Object(Je.a)({},e,t.target.value))}))}};return r.a.createElement(r.a.Fragment,null,u.dev&&r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"ip",label:"IP",onChange:d("ip"),value:u.ip,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"})),r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"port",label:"Port",onChange:d("port"),value:u.port,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"}))),r.a.createElement(ke.a,{container:!0,spacing:2},r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"email",label:"Email",onChange:f("email"),value:u.user.email,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"})),r.a.createElement(ke.a,{item:!0,xs:12,sm:6},r.a.createElement(Ke.a,{id:"password",label:"Password",onChange:f("password"),onKeyPress:function(e){return"Enter"===e.key&&u.user.email&&u.user.password?p():null},value:u.user.password,fullWidth:!0,type:"password",className:t.textField,margin:"normal",variant:"outlined"}))),r.a.createElement(ke.a,{container:!0,justify:"flex-end"},r.a.createElement(ke.a,{item:!0},r.a.createElement(he.a,{onClick:p},"Save"))))}var oa=a(126),la=a.n(oa),sa=(a(226),Object(T.a)(function(e){return{wrapper:{color:e.colors.carbon,backgroundColor:e.colors.silver},divider:{margin:"15px 0"},logo:{backgroundColor:e.colors.phosphorus,color:e.colors.white},latNav:{backgroundColor:e.colors.carbon},avatarContainer:{backgroundColor:e.colors.phosphorus,marginRight:"45px"},latIcons:{margin:"auto",marginTop:"15px",cursor:"pointer",backgroundColor:e.colors.carbon,".active &":{backgroundColor:e.colors.aluminium}},topIcons:{height:"100%",width:"25px",marginRight:"25px",cursor:"pointer"},nav:{marginBottom:"15px",height:"50px","& a":{height:"100%","& img":{height:"100%"}}},footerContainer:{display:"flex",justifyContent:"space-around",justifyItems:"center",padding:"20px 10px 20px 0px"},footer:{color:e.colors.aluminium,display:"flex",flexDirection:"column",justifyContent:"flex-end",fontSize:"9pt","& a":{color:e.colors.aluminium,textDecoration:"none!important"}}}}));function ia(){var e=sa(),t=r.a.useContext(Ze).controller,a=r.a.useState(!(t.user.email&&t.user.password)),n=Object(s.a)(a,2),c=n[0],o=n[1];return console.log(" ====> Rendering layout"),r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,null,r.a.createElement("div",{className:e.wrapper+" wrapper"},r.a.createElement("div",{className:e.logo+" logo"},r.a.createElement(i.b,{to:"/overview"},r.a.createElement("img",{src:la.a,alt:"Edgeworx logomark"}))),r.a.createElement("div",{className:"topnav"},r.a.createElement(d.a,{className:e.topIcons}),r.a.createElement(g.a,{className:e.topIcons}),r.a.createElement(m.a,{className:e.avatarContainer},"M")),r.a.createElement("div",{className:e.latNav+" latnav"},r.a.createElement(i.b,{to:"/overview"},r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(v.a,null))),r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(E.a,null)),r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(y.a,{onClick:function(){return o(!c)}}))),r.a.createElement("div",{className:"content"},r.a.createElement(u.d,null,r.a.createElement(u.b,{path:"/overview",component:na}),r.a.createElement(u.b,{component:function(){return r.a.createElement(u.a,{to:"/overview"})}}))),r.a.createElement("div",{className:"".concat(e.footerContainer," footer")},r.a.createElement("span",{className:e.footer},r.a.createElement("a",{href:"http://www.eclipse.org/legal/copyright.php"},"\xa9 2019 Eclipse Foundation, Inc."))))),r.a.createElement(we,{open:c,title:t.dev?"Controller details":"User credentials",onClose:function(){return o(!1)}},r.a.createElement(ca,{onSave:function(){return o(!1)}})))}a(228);var ua=function(){return console.log(" ======> Rendering app "),r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,null),r.a.createElement(fe,null,r.a.createElement(rt,null,r.a.createElement(Ge,null,r.a.createElement(ia,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(ua,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},37:function(e){e.exports={port:"51121",user:{email:"",password:""}}}},[[142,1,2]]]);
//# sourceMappingURL=main.3e378228.chunk.js.map