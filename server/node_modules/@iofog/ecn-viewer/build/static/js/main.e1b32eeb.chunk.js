(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e){e.exports={palette:{common:{black:"#000",white:"#fff"},background:{paper:"#fff",default:"rgba(250, 252, 255, 1)"},primary:{light:"rgba(65, 119, 153, 1)",main:"rgba(0, 46, 67, 1)",dark:"rgba(0, 33, 48, 1)",contrastText:"#fff"},secondary:{light:"rgba(248, 159, 163, 1)",main:"rgba(255, 88, 93, 1)",dark:"rgba(247, 61, 68, 1)",contrastText:"#fff"},error:{light:"#e57373",main:"#f44336",dark:"#d32f2f",contrastText:"#fff"},text:{primary:"rgba(0, 46, 67, 1)",secondary:"rgba(87, 104, 125, 1)",disabled:"rgba(172, 181, 198, 1)",hint:"rgba(87, 104, 125, 1)"}}}},125:function(e){e.exports=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]},126:function(e,t,a){e.exports=a.p+"static/media/logomark.0af54a67.svg"},142:function(e,t,a){e.exports=a(229)},147:function(e,t,a){},225:function(e,t,a){},226:function(e,t,a){},228:function(e,t,a){},229:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(15),o=a.n(c),l=(a(147),a(283)),s=a(12),i=a(81),u=a(48),m=a(204),p=a(128),d=a.n(p),f=a(129),g=a.n(f),b=a(130),v=a.n(b),h=a(131),E=a.n(h),x=a(132),y=a.n(x),k=a(8),w=a.n(k),j=a(14),O=a(6);var C=a(20),N=a(271),T=a(233),S=a(79),A=a.n(S),I=a(58),F=a(290),R=a(292),P=a(266),M=a(230),D=a(267),U=a(268),W=a(111),z=a.n(W),L=a(112),B=a.n(L),_=a(113),q=a.n(_),G=a(136),H=Object(T.a)(function(e){return{controllerInfo:{paddingTop:"0px","& .paper":{padding:"5px"}},warningChip:{backgroundColor:"var(--color, ".concat(e.colors.danger,")"),color:"white"},controllerTitle:{display:"flex",justifyContent:"space-between",textEmphasis:"bold"}}});function J(e){var t=H(),a=Object(G.a)(),n=e.controller,c=e.loading,o=e.error,l=n.location||{},s=l.city,i=l.country,u=l.lat,m=l.lon,p=l.query,d=o||n.error||null;return r.a.createElement("div",{className:t.controllerInfo},r.a.createElement("div",{className:t.controllerTitle},r.a.createElement(I.a,{variant:"h5"},"Controller"),d&&r.a.createElement(F.a,{title:d.message,"aria-label":"Error"},r.a.createElement(R.a,{label:"The controller is not reachable",style:{"--color":a.colors.gold},className:t.warningChip}))),r.a.createElement(P.a,null,r.a.createElement(M.a,null,r.a.createElement(D.a,null,r.a.createElement(z.a,null)),c?r.a.createElement(U.a,null,r.a.createElement(A.a,null)):r.a.createElement(U.a,{primary:"".concat(s,", ").concat(i)})),r.a.createElement(M.a,{style:{cursor:"pointer"},onClick:function(){return e.selectController()}},r.a.createElement(D.a,null,r.a.createElement(B.a,null)),c?r.a.createElement(U.a,null,r.a.createElement(A.a,null)):r.a.createElement(U.a,{primary:"".concat(u,", ").concat(m)})),r.a.createElement(M.a,null,r.a.createElement(D.a,null,r.a.createElement(q.a,null)),c?r.a.createElement(U.a,null,r.a.createElement(A.a,null)):r.a.createElement(U.a,{primary:p}))))}var K=a(231),V=Object(T.a)({summary:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridColumnGap:"15px",textAlign:"center"}});function Y(e){var t=V(),a=e.activeFlows,n=e.activeAgents,c=e.activeMsvcs,o=e.loading;return r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h5"},"Active resources"),r.a.createElement("br",null),r.a.createElement("div",{className:t.summary},r.a.createElement(K.a,null,r.a.createElement(I.a,{variant:"h3"},o?0:a.length),r.a.createElement(I.a,{variant:"subtitle1"},"Flows")),r.a.createElement(K.a,null,r.a.createElement(I.a,{variant:"h3"},o?0:n.length),r.a.createElement(I.a,{variant:"subtitle1"},"Agents")),r.a.createElement(K.a,null,r.a.createElement(I.a,{variant:"h3"},o?0:c.length),r.a.createElement(I.a,{variant:"subtitle1"},"Microservices"))))}var Q=a(62),X=a.n(Q),Z=a(280),$=a(281),ee=a(134),te=a(277),ae=a(121),ne=a.n(ae),re=a(77),ce=a.n(re),oe=a(269),le=a(133),se=a(114),ie={phosphorus:"#FF585D",cobalt:"#5064EC",gold:"#F5A623",chromium:"#00C0A9",argon:"#7A3BFF",carbon:"#002E43",lead:"#57687D",aluminium:"#ACB5C6",silver:"#FAFCFF",white:"#FFFFFF"},ue=Object(le.a)(Object(O.a)({},se,{colors:Object(O.a)({},ie,{success:ie.chromium,error:ie.phosphorus,danger:ie.gold})}));function me(e){return r.a.createElement(oe.a,{theme:ue},e.children)}var pe={RUNNING:ue.colors.chromium,UNKNOWN:ue.colors.aluminium,OFFLINE:ue.colors.phosphorus},de={RUNNING:ue.colors.cobalt,UNKNOWN:ue.colors.aluminium,OFFLINE:ue.colors.aluminium},fe=a(285),ge=a(270),be=a(47),ve=a.n(be),he=Object(T.a)(function(e){return{modalTitle:{backgroundColor:e.colors.carbon,borderRadius:"4px 4px 0 0",color:"white",padding:"5px",display:"flex",justifyContent:"space-between"},modal:{width:"60%",top:"15%",left:"20%",position:"absolute",borderRadius:"4px"},modalContent:{maxHeight:"600px",overflowY:"scroll",padding:"15px"},modalActions:{display:"flex",backgroundColor:e.colors.silver,alignItems:"flex-end"},modalAction:{marginLeft:"5px"}}});function Ee(e){var t=he(),a=e.title,n=e.open,c=e.onClose;return r.a.createElement(fe.a,Object.assign({"aria-labelledby":"".concat(a," modal")},{open:n,onClose:c}),r.a.createElement(K.a,{className:t.modal},r.a.createElement("div",{className:t.modalTitle},r.a.createElement(I.a,{variant:"h5"},a),r.a.createElement(ve.a,{style:{cursor:"pointer"},onClick:c})),r.a.createElement("div",{className:t.modalContent},e.children),e.actions&&!!e.actions.length&&r.a.createElement("div",{className:t.modalActions},e.actions.map(function(e){return r.a.createElement(ge.a,{className:"".concat(e.className," ").concat(t.modalAction),variant:e.variant,onClick:e.onClick},e.text)}))))}var xe=a(272),ye=Object(T.a)(function(e){return{divider:{margin:"5px"}}});function ke(e){var t=ye(),a=e.open,n=e.onClose,c=e.title,o=e.onConfirm;return r.a.createElement(Ee,{title:c,open:a,onClose:n},e.children,r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,justify:"flex-end",spacing:2},r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{onClick:n},"Cancel")),r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{variant:"contained",color:"primary",onClick:o},"Confirm"))))}var we=a(17),je=a(274),Oe=a(116),Ce=a.n(Oe),Ne=a(115),Te=a.n(Ne),Se=a(117),Ae=a.n(Se),Ie=a(118),Fe=a.n(Ie),Re=a(232),Pe=a(273),Me={success:Te.a,warning:Ce.a,error:Ae.a,info:Fe.a},De=Object(Re.a)(function(e){return{success:{backgroundColor:e.colors.success},error:{backgroundColor:e.colors.error},info:{backgroundColor:e.colors.cobalt},warning:{backgroundColor:e.colors.danger},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"},alert:{margin:"5px",borderRadius:"4px",boxShadow:"0 4px 6px 0 ".concat(e.colors.carbon)},container:{display:"flex",flexDirection:"column",position:"fixed",bottom:"10px",left:"10px",zIndex:"9999"}}});function Ue(e){var t=De(),a=e.open,n=e.alerts;return a?r.a.createElement("div",{className:t.container},n.map(function(e,a){var n=e.type||"info",c=Me[n];return r.a.createElement(Pe.a,{key:e.key||e.id||a,className:"".concat(t[n]," ").concat(t.alert," ").concat(e.className),"aria-describedby":"client-snackbar",message:r.a.createElement("span",{id:"client-snackbar",className:t.message},r.a.createElement(c,{className:"".concat(t.icon," ").concat(t.iconVariant)}),e.message),action:[r.a.createElement(je.a,{key:"close","aria-label":"Close",color:"inherit",onClick:e.onClose},r.a.createElement(ve.a,{className:t.icon}))]})})):null}var We=r.a.createContext({feedbacks:[],setFeedbacks:function(){},pushFeedback:function(){}}),ze={ADD:"add",REMOVE:"remove",SET:"set"},Le={feedbacks:[],nextId:0},Be=function(e,t){switch(t.type){case ze.ADD:return{feedbacks:[].concat(Object(we.a)(e.feedbacks),[Object(O.a)({},t.data,{timeout:setTimeout(function(){t.dispatch({type:ze.REMOVE,data:{id:e.nextId}})},6e3),id:e.nextId})]),nextId:e.nextId+1};case ze.REMOVE:var a=Object(C.findIndex)(e.feedbacks,function(e){return e.id===t.data.id});return-1===a?e:Object(O.a)({},e,{feedbacks:[].concat(Object(we.a)(e.feedbacks.slice(0,a)),Object(we.a)(e.feedbacks.slice(a+1)))});case ze.SET:return Object(O.a)({},e,{feedbacks:t.data});default:return e}};function _e(e){var t=r.a.useReducer(Be,Le),a=Object(s.a)(t,2),n=a[0],c=a[1];return console.log("======> Updating feedback context"),r.a.createElement(We.Provider,{value:{feedbacks:n.feedbacks,setFeedbacks:function(e){console.log(" ---\x3e SetFeedbacks "),c({type:ze.SET,data:e})},pushFeedback:function(e){console.log(" ---\x3e pushFeedback "),c({type:ze.ADD,data:e,dispatch:c}),n.feedbacks.push(e)}}},e.children,r.a.createElement(We.Consumer,null,function(e){var t=e.feedbacks;e.setFeedbacks;return r.a.createElement(Ue,{open:!!t.length,alerts:t.map(function(e,t){return Object(O.a)({},e,{onClose:function(){return c({type:ze.REMOVE,data:e})}})})})}))}var qe=a(30),Ge=a(288),He=a(37),Je=function(){var e=window.localStorage.getItem("iofogUser");return e&&(He.user=JSON.parse(e)),Object(O.a)({},He,{api:"".concat(window.location.protocol,"//").concat(He.ip,":").concat(He.port||80,"/"),location:{lat:"Unknown",lon:"Unknown",query:He.ip}})}(),Ke=function(e){return He.dev?"/api/controllerApi".concat(e):"".concat(window.location.protocol,"//").concat([window.location.hostname,He.port].join(":")).concat(e)},Ve=function(e,t){return He.dev?Object(O.a)({},e,{"ECN-Api-Destination":t.api}):e},Ye=r.a.createContext({controller:{},updateController:function(){}}),Qe=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.ip||(t.ip=window.location.host.split(":")[0]),a=new RegExp("(0.0.0.0|localhost|127.0.0.1|192.168.)"),n=a.test(t.ip)?"8.8.8.8":t.ip,e.next=5,window.fetch("http://ip-api.com/json/"+n);case 5:if(!(r=e.sent).ok){e.next=10;break}return e.abrupt("return",r.json());case 10:throw new Error(r.statusText);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Xe=function(){var e=Object(j.a)(w.a.mark(function e(t){var a;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.prev=1,e.next=4,Qe(t);case 4:a=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),a={lat:"Unknown",lon:"Unknown",query:t.ip};case 10:return e.abrupt("return",Object(O.a)({},t,{location:a}));case 11:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),Ze={controller:Je,token:null},$e={ERROR:"Error",CLEAN_ERROR:"Clean error",UPDATE:"Update",SET_TOKEN:"Set token"},et=function(e,t){console.log({state:e,action:t});var a=function(){switch(t.type){case $e.ERROR:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,{error:t.data})});case $e.CLEAN_ERROR:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,{error:null})});case $e.UPDATE:return Object(O.a)({},e,{controller:Object(O.a)({},e.controller,t.data)});case $e.SET_TOKEN:return Object(O.a)({},e,{token:t.data,controller:Object(O.a)({},e.controller,{error:null})});default:return e}}();return a.controller.dev=He.dev,a};function tt(e){var t=r.a.useReducer(et,Ze),a=Object(s.a)(t,2),c=a[0],o=a[1],l=c.token,i=c.controller;console.log("======> Updating controller context");var u=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(Ke("/api/v3/user/login"),{method:"POST",headers:Ve({Accept:"application/json","Content-Type":"application/json"},t),body:JSON.stringify(t.user)});case 2:if(!(a=e.sent).ok){e.next=11;break}return e.next=6,a.json();case 6:return n=e.sent.accessToken,o({type:$e.SET_TOKEN,data:n}),e.abrupt("return",n);case 11:throw o({type:$e.SET_TOKEN,data:null}),new Error(a.statusText);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n,r,s=arguments;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>1&&void 0!==s[1]?s[1]:{},e.prev=1,n=l){e.next=7;break}return e.next=6,u(i);case 6:n=e.sent;case 7:return e.next=9,window.fetch(Ke(t),Object(O.a)({},a,{headers:Ve(Object(O.a)({},a.headers,{Authorization:n}),i)}));case 9:return r=e.sent,c.controller.error&&o({type:$e.CLEAN_ERROR}),e.abrupt("return",r);case 14:return e.prev=14,e.t0=e.catch(1),o({type:$e.ERROR,data:e.t0}),e.abrupt("return",{ok:!1,statusText:e.t0.message||"Could not reach controller"});case 18:case"end":return e.stop()}},e,null,[[1,14]])}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(j.a)(w.a.mark(function e(t){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return He.dev&&(t.api="http://".concat(t.ip,":").concat(t.port||80,"/")),window.localStorage.setItem("iofogUser",JSON.stringify(t.user)),e.prev=2,e.next=5,u(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),o({type:$e.ERROR,data:e.t0});case 10:return e.t1=o,e.t2=$e.UPDATE,e.next=14,Xe(t);case 14:e.t3=e.sent,e.t4={type:e.t2,data:e.t3},(0,e.t1)(e.t4);case 17:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)(function(){return Object(j.a)(w.a.mark(function e(){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(Ze.controller);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),o({type:$e.ERROR,data:e.t0});case 8:return e.t1=o,e.t2=$e.UPDATE,e.next=12,Xe(Ze.controller);case 12:e.t3=e.sent,e.t4={type:e.t2,data:e.t3},(0,e.t1)(e.t4);case 15:case"end":return e.stop()}},e,null,[[0,5]])}))()},[]),r.a.createElement(Ye.Provider,{value:{controller:i,updateController:p,request:m}},e.children)}var at=Object(T.a)({divider:{margin:"5px"}}),nt={name:"",ip:"",key:"",port:54321},rt=function(e){return{message:e}};function ct(e){var t=at(),a=r.a.useState(Object(O.a)({},nt)),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useContext(We).pushFeedback,i=r.a.useContext(Ye).request,u=function(e){return function(t){o(Object(O.a)({},c,Object(qe.a)({},e,t.target.value)))}},m=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("/api/v3/iofog",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});case 2:if(!(a=e.sent).ok){e.next=9;break}return l({message:"ioFog created!",type:"success"}),e.next=7,a.json();case 7:return n=e.sent,e.abrupt("return",n.uuid);case 9:throw rt("Failed to create iofog: ".concat(a.statusText));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("/api/v3/iofog/".concat(t,"/provisioning-key"));case 2:if(!(a=e.sent).ok){e.next=8;break}return e.next=6,a.json();case 6:return n=e.sent,e.abrupt("return",n.key);case 8:throw rt("Failed to retrieve provisioning key: ".concat(a.statusText));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=Object(j.a)(w.a.mark(function e(t,a){var n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch("api/agentApi/v2/config",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t.key,ioFogApi:"http://".concat(t.ip,":").concat(t.port)},body:JSON.stringify({"controller-url":"http://".concat(a.ip,":").concat(a.port,"/api/v3/")})});case 2:if(!(n=e.sent).ok){e.next=6;break}return l({message:"Agent linked!",type:"success"}),e.abrupt("return",!0);case 6:throw rt("Failed to link agent: ".concat(n.statusText));case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),f=function(){var e=Object(j.a)(w.a.mark(function e(t,a){var n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch("api/agentApi/v2/provision",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t.key,ioFogApi:"http://".concat(t.ip,":").concat(t.port)},body:JSON.stringify({"provisioning-key":a})});case 2:if(!(n=e.sent).ok){e.next=6;break}return l({message:"Agent provisioned!",type:"success"}),e.abrupt("return",!0);case 6:throw rt("Failed to provision agent: ".concat(n.statusText));case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),g=function(){var t=Object(j.a)(w.a.mark(function t(){var a,n;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m({name:c.name,fogType:0});case 3:return a=t.sent,t.next=6,p(a);case 6:return n=t.sent,t.next=9,d(c,e.controller);case 9:return t.next=11,f(c,n);case 11:l({message:"Agent connected!",type:"success"}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),l({message:t.t0.message,type:"error",uuid:"error"});case 17:case"end":return t.stop()}},t,null,[[0,14]])}));return function(){return t.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"name",label:"Name",onChange:u("name"),value:c.name,fullWidth:!0,className:t.textField,margin:"normal"})),r.a.createElement(xe.a,{item:!0,xs:6,sm:3},r.a.createElement(Ge.a,{id:"ip",label:"IP",onChange:u("ip"),value:c.ip,fullWidth:!0,className:t.textField,margin:"normal"})),r.a.createElement(xe.a,{item:!0,xs:6,sm:3},r.a.createElement(Ge.a,{id:"port",label:"Port",onChange:u("port"),value:c.port,fullWidth:!0,type:"number",className:t.textField,margin:"normal"})),r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(Ge.a,{id:"key",label:"Authorization key",onChange:u("key"),value:c.key,fullWidth:!0,className:t.textField,margin:"normal",helperText:"Authorization key can be found in /etc/iofog-agent/local-api file"}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,justify:"flex-end"},r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{onClick:g},"Connect"))))}var ot=a(49),lt=a.n(ot),st=a(276),it=a(278),ut=a(286),mt=a(291),pt=a(287),dt=a(275),ft=a(120),gt=a.n(ft),bt=a(91),vt=a(135),ht=a(119),Et=a.n(ht),xt=Object(Re.a)(function(e){return{root:{flexGrow:1,height:250},container:{flexGrow:1,position:"relative"},paper:{position:"absolute",zIndex:1,marginTop:e.spacing(1),marginBot:e.spacing(2),left:0,right:0,maxHeight:"250px",overflowY:"scroll"},chip:{margin:e.spacing(.5,.25)},inputRoot:{flexWrap:"wrap"},inputInput:{width:"auto",flexGrow:1},divider:{height:e.spacing(2)}}});function yt(e){var t=xt();return r.a.createElement(vt.a,Object.assign({itemToString:function(e){return lt()(e,"label","")},onChange:e.onChange,initialSelectedItem:e.initialSelectedItem},e.selectedItem?{selectedItem:e.selectedItem}:{},{id:"downshift-options"}),function(a){var n=a.clearSelection,c=a.getInputProps,o=a.getItemProps,l=a.getLabelProps,s=a.getMenuProps,i=a.highlightedIndex,u=a.inputValue,m=a.isOpen,p=a.openMenu,d=a.selectedItem,f=c({onChange:function(e){""===e.target.value&&n()},onFocus:p,disabled:e.disabled||!1,placeholder:e.placeholder||""}),g=f.onBlur,b=f.onChange,v=f.onFocus,h=Object(bt.a)(f,["onBlur","onChange","onFocus"]);return r.a.createElement("div",{className:t.container},function(e){var t=e.InputProps,a=e.classes,n=e.ref,c=Object(bt.a)(e,["InputProps","classes","ref"]);return r.a.createElement(Ge.a,Object.assign({InputProps:Object(O.a)({inputRef:n,classes:{root:a.inputRoot,input:a.inputInput}},t)},c))}({fullWidth:!0,classes:t,label:e.label,InputLabelProps:l({shrink:!0}),InputProps:{onBlur:g,onChange:b,onFocus:v},inputProps:h}),r.a.createElement("div",s(),m?r.a.createElement(K.a,{className:t.paper,square:!0},function(t){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).showEmpty,n=void 0!==a&&a,r=Et()(t.trim()).toLowerCase(),c=r.length,o=0;return 0!==c||n?e.suggestions.filter(function(t){var a=o<e.maxSuggestions&&t.label.toLowerCase().startsWith(r.toLowerCase());return a&&(o+=1),a}):[]}(u,{showEmpty:!0}).map(function(e,t){return function(e){var t=e.suggestion,a=e.index,n=e.itemProps,c=e.highlightedIndex===a,o=(e.selectedItem||{}).label===t.label;return r.a.createElement(te.a,Object.assign({},n,{key:t.label,selected:c,component:"div",style:{fontWeight:o?500:400}}),t.label)}({suggestion:e,index:t,itemProps:o({item:e}),highlightedIndex:i,selectedItem:d})})):null))})}var kt=Object(T.a)({divider:{margin:"5px"},formControl:{width:"100%"},rowIcon:{display:"flex",justifyContent:"space-around"},newPaper:{border:"1px solid hsla(0, 0%, 0%, 0.2)",boxShadow:"0 4px 6px 0 hsla(0,0%,0%,0.2)",borderRadius:"4px",padding:"10px",marginTop:"10px"},inputWithIcon:{display:"flex",alignItems:"baseline",justifyContent:"space-between"}}),wt={PaperProps:{style:{maxHeight:224,width:250}}},jt={flow:{},name:"",catalog:{images:[]},volumeMappings:[],ports:[],rootHostAccess:!1,_new:!0},Ot={name:"",isActivated:!0},Ct=function(e){return{name:"",images:[{containerImage:"",fogTypeId:e}],registryId:1}},Nt=function(e){return{from:e,to:{}}},Tt=function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)},St=function(e,t,a,n){var c=lt()(e,"_new",!1);return r.a.createElement(yt,{label:a,placeholder:"Select a microservice",onChange:n,disabled:c,selectedItem:c?t[t.length-1]:e,maxSuggestions:20,suggestions:t.filter(function(e){return!!c||!!e.uuid}).map(function(e){return Object(O.a)({},e,{label:e.name})})})};function At(e){var t=kt(),a=r.a.useState([]),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useState([]),i=Object(s.a)(l,2),u=i[0],m=i[1],p=r.a.useRef({}),d=r.a.useRef(r.a.createElement(X.a,{src:p.current,name:!1,onAdd:function(e){p.current=e.updated_src},onEdit:function(e){p.current=e.updated_src},onDelete:function(e){p.current=e.updated_src}})),f=r.a.useState(jt),g=Object(s.a)(f,2),b=g[0],v=g[1],h=r.a.useState(Ot),E=Object(s.a)(h,2),x=E[0],y=E[1],k=r.a.useState(function(){return Ct(lt()(e,"target.fogTypeId",1))}),C=Object(s.a)(k,2),T=C[0],S=C[1],A=r.a.useState([]),F=Object(s.a)(A,2),R=F[0],P=F[1],M=e.target,D=r.a.useContext(We).pushFeedback,U=r.a.useContext(Ye).request;r.a.useEffect(function(){Promise.all([Object(j.a)(w.a.mark(function e(){var t,a;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U("/api/v3/flow");case 2:if(!(t=e.sent).ok){e.next=8;break}return e.next=6,t.json();case 6:a=e.sent,o(a.flows);case 8:case"end":return e.stop()}},e)}))(),Object(j.a)(w.a.mark(function e(){var t,a;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U("/api/v3/catalog/microservices");case 2:if(!(t=e.sent).ok){e.next=8;break}return e.next=6,t.json();case 6:a=e.sent,m(a.catalogItems.filter(function(e){var t=!0,a=!1,n=void 0;try{for(var r,c=e.images[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){if(r.value.fogTypeId===M.fogTypeId)return!0}}catch(o){a=!0,n=o}finally{try{t||null==c.return||c.return()}finally{if(a)throw n}}return!1}));case 8:case"end":return e.stop()}},e)}))()])},[M.fogTypeId,U]);var W=function(e,t,a){return function(n){return t(Object(O.a)({},a,Object(qe.a)({},e,n.target.value)))}},z=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e){return e};return function(r){return v(Object(O.a)({},b,Object(qe.a)({},e,[].concat(Object(we.a)(b[e].slice(0,a)),[Object(O.a)({},b[e][a],Object(qe.a)({},t,n(r.target.value)))],Object(we.a)(b[e].slice(a+1))))))}},L=function(e){if(!lt()(e,"id",null))return"Select an image";var t=!0,a=!1,n=void 0;try{for(var r,c=e.images[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){var o=r.value;if(o.fogTypeId===M.fogTypeId)return o.containerImage}}catch(l){a=!0,n=l}finally{try{t||null==c.return||c.return()}finally{if(a)throw n}}return"Image not found"},B=function(e,t){return v(Object(O.a)({},b,Object(qe.a)({},e,[].concat(Object(we.a)(b[e].slice(0,t)),Object(we.a)(b[e].slice(t+1))))))},_=function(){var e=Object(j.a)(w.a.mark(function e(){var t,a,n,r,c,o;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=b.name,a=b.ports,n=b.volumeMappings,r=b.rootHostAccess,e.next=4,U("/api/v3/microservices",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({config:JSON.stringify(p.current),name:t,ports:a,volumeMappings:n,rootHostAccess:r,flowId:b.flow.id,iofogUuid:M.uuid,catalogItemId:b.catalog.id})});case 4:if(!(c=e.sent).ok){e.next=14;break}return D({message:"Microservice added!",type:"success"}),e.next=9,c.json();case 9:return o=e.sent,v(jt),e.abrupt("return",o.uuid);case 14:D({message:c.statusText,type:"error"});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),D({message:e.t0.message});case 20:case"end":return e.stop()}},e,null,[[0,17]])}));return function(){return e.apply(this,arguments)}}(),q=function(){var e=Object(j.a)(w.a.mark(function e(){var t,a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=x.name,e.next=4,U("/api/v3/flow",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(x)});case 4:if(!(a=e.sent).ok){e.next=20;break}return D({message:"Flow created!",type:"success"}),y(Ot),e.t0=O.a,e.t1={},e.next=12,a.json();case 12:return e.t2=e.sent,e.t3={name:t},n=(0,e.t0)(e.t1,e.t2,e.t3),v(Object(O.a)({},b,{flow:n})),b.flow=n,e.abrupt("return",!0);case 20:return D({message:a.statusText,type:"error"}),e.abrupt("return",!1);case 22:e.next=28;break;case 24:return e.prev=24,e.t4=e.catch(0),D({message:e.t4.message}),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,null,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(j.a)(w.a.mark(function e(){var t,a,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Object(O.a)({},T,{name:Tt()}),e.next=4,U("/api/v3/catalog/microservices",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});case 4:if(!(a=e.sent).ok){e.next=20;break}return D({message:"Image added to catalog!",type:"success"}),S(Ct(M.fogTypeId)),e.t0=O.a,e.t1={},e.next=12,a.json();case 12:return e.t2=e.sent,e.t3=t,n=(0,e.t0)(e.t1,e.t2,e.t3),v(Object(O.a)({},b,{catalog:n})),b.catalog=n,e.abrupt("return",!0);case 20:return D({message:a.statusText,type:"error"}),e.abrupt("return",!1);case 22:e.next=28;break;case 24:return e.prev=24,e.t4=e.catch(0),D({message:e.t4.message}),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,null,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=lt()(t,"from.uuid"),n=lt()(t,"to.uuid"),e.next=5,U("/api/v3//microservices/".concat(a,"/routes/").concat(n),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:""});case 5:if(!(r=e.sent).ok){e.next=11;break}return D({message:"Route from ".concat(t.from.name," to ").concat(t.to.name," created !"),type:"success"}),e.abrupt("return",!0);case 11:return D({message:r.statusText,type:"error"}),e.abrupt("return",!1);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(0),D({message:e.t0.message}),e.abrupt("return",!1);case 19:case"end":return e.stop()}},e,null,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(j.a)(w.a.mark(function e(t){var a,n,r,c,o,l;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=!0,n=!1,r=void 0,e.prev=3,c=R[Symbol.iterator]();case 5:if(a=(o=c.next()).done){e.next=14;break}return(l=o.value).from.uuid||(l.from.uuid=t),l.to.uuid||(l.to.uuid=t),e.next=11,H(l);case 11:a=!0,e.next=5;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),n=!0,r=e.t0;case 20:e.prev=20,e.prev=21,a||null==c.return||c.return();case 23:if(e.prev=23,!n){e.next=26;break}throw r;case 26:return e.finish(23);case 27:return e.finish(20);case 28:case"end":return e.stop()}},e,null,[[3,16,20,28],[21,,23,27]])}));return function(t){return e.apply(this,arguments)}}(),V=function(){var t=Object(j.a)(w.a.mark(function t(){var a,n;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=!0,t.prev=1,-1!==b.flow.id){t.next=6;break}return t.next=5,q();case 5:a=t.sent;case 6:if(!a||-1!==b.catalog.id){t.next=10;break}return t.next=9,G();case 9:a=t.sent;case 10:if(!a){t.next=17;break}return t.next=13,_();case 13:return n=t.sent,t.next=16,J(n);case 16:e.onSuccess();case 17:t.next=21;break;case 19:t.prev=19,t.t0=t.catch(1);case 21:case"end":return t.stop()}},t,null,[[1,19]])}));return function(){return t.apply(this,arguments)}}(),Y=(e.microservices||[]).map(function(e){return Object(O.a)({},e,{label:e.name})}).concat([Object(O.a)({},b,{label:b.name?b.name:"<New microservice>"})]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(st.a,{className:t.formControl},r.a.createElement(yt,{label:"Flow",placeholder:"Select a flow",onChange:function(e,t){W("flow",v,b)({target:{value:e||{}}})},maxSuggestions:20,suggestions:c.map(function(e){return Object(O.a)({},e,{label:e.name})}).concat([{id:-1,label:"+ Add a flow"}])})),-1===b.flow.id&&r.a.createElement(K.a,{className:t.newPaper},r.a.createElement(I.a,{variant:"subtitle2"},"New flow"),r.a.createElement(Ge.a,{id:"name",label:"Name",required:!0,onChange:W("name",y,x),value:x.name,fullWidth:!0,className:t.textField,margin:"normal"}),r.a.createElement(it.a,{style:{color:"rgba(0, 0, 0, 0.54)"},control:r.a.createElement(ut.a,{checked:x.isActivated,onChange:function(e){return y(Object(O.a)({},x,{isActivated:e.target.checked}))},value:"checkedB",color:"primary"}),label:"Active"}))),r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(st.a,{className:t.formControl},r.a.createElement(yt,{label:"Image",placeholder:"Select an image",onChange:function(e,t){W("catalog",v,b)({target:{value:e||{}}})},maxSuggestions:20,suggestions:u.map(function(e){return Object(O.a)({},e,{label:L(e)})}).concat([{id:-1,label:"+ Add an image"}])})),-1===b.catalog.id&&r.a.createElement(K.a,{className:t.newPaper},r.a.createElement(I.a,{variant:"subtitle2"},"New image"),r.a.createElement(Ge.a,{id:"name",label:"Name",required:!0,onChange:function(e){return S(Object(O.a)({},T,{images:[Object(O.a)({},T.images[0],{containerImage:e.target.value})]}))},value:T.images[0].containerImage,fullWidth:!0,className:t.textField,margin:"normal"})))),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(Ge.a,{id:"name",label:"Name",required:!0,onChange:W("name",v,b),value:b.name,fullWidth:!0,className:t.textField,margin:"normal"}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Configuration"),r.a.createElement("br",null),d.current)),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Volumes"),r.a.createElement("br",null),b.volumeMappings.map(function(e,a){return r.a.createElement(xe.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(xe.a,{item:!0,xs:11},r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:4},r.a.createElement(Ge.a,{id:"host",label:"Host",required:!0,onChange:z("volumeMappings","hostDestination",a),value:e.hostDestination,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(xe.a,{item:!0,xs:12,sm:4},r.a.createElement(Ge.a,{id:"Container",label:"Container",required:!0,onChange:z("volumeMappings","containerDestination",a),value:e.containerDestination,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(xe.a,{item:!0,xs:12,sm:4},r.a.createElement(st.a,{className:t.formControl,style:{marginTop:"5px"}},r.a.createElement(mt.a,{htmlFor:"select-flow"},"Access mode"),r.a.createElement(pt.a,{required:!0,value:e.accessMode,onChange:z("volumeMappings","accessMode",a),input:r.a.createElement(dt.a,{id:"select-flow-input"}),MenuProps:wt},r.a.createElement(te.a,{value:"z"},"Z")))))),r.a.createElement(xe.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(ve.a,{style:{cursor:"pointer"},onClick:function(){return B("volumeMappings",a)}})))}),r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return v(Object(O.a)({},b,{volumeMappings:[].concat(Object(we.a)(b.volumeMappings),[{hostDestination:"",containerDestination:"",accessMode:"z"}])}))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Ports"),r.a.createElement("br",null),b.ports.map(function(e,a){return r.a.createElement(xe.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(xe.a,{item:!0,xs:11},r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"host",label:"External",required:!0,type:"number",onChange:z("ports","external",a,parseInt),value:e.external,fullWidth:!0,className:t.textField,margin:"dense"})),r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"Container",label:"Internal",required:!0,fullWidth:!0,type:"number",onChange:z("ports","internal",a,parseInt),value:e.internal,className:t.textField,margin:"dense"})))),r.a.createElement(xe.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(ve.a,{style:{cursor:"pointer"},onClick:function(){return B("ports",a)}})))}),r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return v(Object(O.a)({},b,{ports:[].concat(Object(we.a)(b.ports),[{internal:"",external:""}])}))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12},r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)"},variant:"subtitle1"},"Routes"),r.a.createElement("br",null),R.map(function(e,a){return r.a.createElement(xe.a,{container:!0,spacing:2,key:a,style:{alignItems:"flex-end"}},r.a.createElement(xe.a,{item:!0,xs:11},r.a.createElement(xe.a,{container:!0,spacing:2,style:{alignItems:"flex-end"}},r.a.createElement(xe.a,{item:!0,xs:12,sm:5},St(e.from,Y,"From",function(t){return P([].concat(Object(we.a)(R.slice(0,a)),[Object(O.a)({},e,{from:t||{}})],Object(we.a)(R.slice(a+1))))})),r.a.createElement(xe.a,{item:!0,xs:2,className:t.rowIcon},r.a.createElement(gt.a,{style:{cursor:"pointer"},onClick:function(){return P([].concat(Object(we.a)(R.slice(0,a)),[Object(O.a)({},e,{from:e.to,to:e.from})],Object(we.a)(R.slice(a+1))))}})),r.a.createElement(xe.a,{item:!0,xs:12,sm:5},St(e.to,Y,"To",function(t){return P([].concat(Object(we.a)(R.slice(0,a)),[Object(O.a)({},e,{to:t||{}})],Object(we.a)(R.slice(a+1))))})))),r.a.createElement(xe.a,{item:!0,xs:1,className:t.rowIcon},r.a.createElement(ve.a,{style:{cursor:"pointer"},onClick:function(){return P([].concat(Object(we.a)(R.slice(0,a)),Object(we.a)(R.slice(a+1))))}})))}),r.a.createElement(I.a,{style:{color:"rgba(0, 0, 0, 0.54)",cursor:"pointer"},variant:"caption",onClick:function(){return P([].concat(Object(we.a)(R),[Nt(b)]))}},"+ Add"))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(it.a,{style:{color:"rgba(0, 0, 0, 0.54)"},control:r.a.createElement(ut.a,{checked:b.rootHostAccess,onChange:function(e){return v(Object(O.a)({},b,{rootHostAccess:e.target.checked}))},value:"checkedB",color:"primary"}),label:"Root host access"}),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,justify:"flex-end"},r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{onClick:V},"Add"))))}var It=Object(T.a)({chips:{display:"flex",flexWrap:"wrap"},chip:{margin:2},formControl:{width:"100%",marginBottom:"15px"},divider:{margin:"5px"}}),Ft={PaperProps:{style:{maxHeight:224,width:250}}};function Rt(e){var t=It(),a=r.a.useState([]),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useContext(We).pushFeedback,i=r.a.useContext(Ye).request;var u=function(){var t=Object(j.a)(w.a.mark(function t(){var a,n,r,s,u,m,d,f,g;return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,a=!0,n=!0,r=!1,s=void 0,t.prev=5,u=c[Symbol.iterator]();!(n=(m=u.next()).done);n=!0)d=m.value,(f=i("/api/v3/microservices/".concat(d),{method:"DELETE"})).ok?(g=c.indexOf(d),o([].concat(Object(we.a)(c.slice(0,g)),Object(we.a)(c.slice(g+1))))):(a=!1,l({message:"".concat(p[d].name,": ").concat(f.statusText),type:"error",uuid:d}));t.next=13;break;case 9:t.prev=9,t.t0=t.catch(5),r=!0,s=t.t0;case 13:t.prev=13,t.prev=14,n||null==u.return||u.return();case 16:if(t.prev=16,!r){t.next=19;break}throw s;case 19:return t.finish(16);case 20:return t.finish(13);case 21:a&&(l({message:"Microservices removed",type:"success",uuid:"success"}),e.onSuccess()),t.next=27;break;case 24:t.prev=24,t.t1=t.catch(0),l({message:t.t1.message,type:"error",uuid:"error"});case 27:case"end":return t.stop()}},t,null,[[0,24],[5,9,13,21],[14,,16,20]])}));return function(){return t.apply(this,arguments)}}(),m=e.msvcs,p=m.reduce(function(e,t){return Object(O.a)({},e,Object(qe.a)({},t.uuid,t))},{});return r.a.createElement(r.a.Fragment,null,r.a.createElement(st.a,{className:t.formControl},r.a.createElement(mt.a,{htmlFor:"select-multiple-checkbox"},"Microservices to remove"),r.a.createElement(pt.a,{multiple:!0,value:c,onChange:function(e){o(e.target.value)},input:r.a.createElement(dt.a,{id:"select-multiple-checkbox-rm-msvcs"}),renderValue:function(e){return r.a.createElement("div",{className:t.chips},e.map(function(e){return p[e]&&r.a.createElement(R.a,{key:e,label:p[e].name,className:t.chip})}))},MenuProps:Ft},m.map(function(e){return r.a.createElement(te.a,{key:e.uuid,value:e.uuid},r.a.createElement(ut.a,{checked:c.indexOf(e.uuid)>-1}),r.a.createElement(U.a,{primary:e.name}))}))),r.a.createElement(N.a,{className:t.divider}),r.a.createElement(xe.a,{container:!0,justify:"flex-end"},r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{onClick:u},"Remove"))))}var Pt=a(284),Mt=a(279);function Dt(e){return r.a.createElement(I.a,{component:"div",style:{padding:24}},e.children)}var Ut=Object(Re.a)(function(e){return{root:{flexGrow:1,backgroundColor:e.palette.background.paper}}});function Wt(e){var t=Ut(),a=r.a.useState(0),n=Object(s.a)(a,2),c=n[0],o=n[1];return r.a.createElement("div",{className:t.root},r.a.createElement(Pt.a,{value:c,onChange:function(e,t){o(t)}},e.children.map(function(e){return r.a.createElement(Mt.a,{label:e.props.title})})),r.a.createElement(Dt,null,e.children[c]))}var zt=Object(T.a)(function(e){return{avatarList:{color:"white",backgroundColor:"var(--statusColor, white)",boxShadow:"0px 2px 2px ".concat(e.colors.carbon)},msvcChipList:{display:"flex",flexDirection:"column",width:"20%",flex:"1",paddingRight:"15px"},msvcChip:{marginTop:"var(--mTop, 0px)",backgroundColor:"var(--color, ".concat(e.colors.cobalt,")"),fontSize:"10px",borderRadius:"5px",height:"20px",margin:"2px",width:"100px",color:"white","& .MuiChip-label":{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",display:"block"}},jsonDisplay:{width:"99%",minHeight:"30rem",fontFamily:'"Lucida Console", Monaco, monospace',fontSize:"0.8rem",lineHeight:"1.2"},listTitle:{display:"flex",justifyContent:"space-between",alignItems:"baseline",color:e.palette.text.primary},link:{color:e.palette.text.secondary,cursor:"pointer","&:hover":{textDecoration:"underline"}}}});function Lt(e){var t=zt(),a=r.a.useState(!1),n=Object(s.a)(a,2),c=n[0],o=n[1],l=r.a.useState(!1),i=Object(s.a)(l,2),u=i[0],p=i[1],d=r.a.useState(!1),f=Object(s.a)(d,2),g=f[0],b=f[1],v=r.a.useState(!1),h=Object(s.a)(v,2),E=h[0],x=h[1],y=r.a.useState(!1),k=Object(s.a)(y,2),O=k[0],C=k[1],N=r.a.useState(null),T=Object(s.a)(N,2),S=T[0],A=T[1],F=e.msvcsPerAgent,D=e.msvcs,W=e.agents,z=e.agent,L=e.setAgent,B=e.setAutozoom,_=e.loading,q=r.a.useContext(We),G=r.a.useContext(Ye).request,H=function(){return A(null)},J=function(e){return A(e.currentTarget)},K=function(){var e=Object(j.a)(w.a.mark(function e(t){var a;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G("/api/v3/iofog/".concat(t.uuid),{method:"DELETE"});case 3:(a=e.sent).ok?q.pushFeedback({message:"Agent removed!",type:"success"}):q.pushFeedback({message:"Failed to remove node: ".concat(a.statusText),type:"error"}),o(!1),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),q.pushFeedback({message:e.t0.message,type:"error"});case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(P.a,{subheader:r.a.createElement(Z.a,{component:"div",id:"agent-list-subheader",style:{position:"relative"},disableGutters:!0,disableSticky:!0},r.a.createElement("div",{className:t.listTitle},r.a.createElement("div",null,r.a.createElement(I.a,{variant:"h5"},"Agents - ",r.a.createElement("small",null,_?0:W.length," nodes"))),r.a.createElement("div",null,r.a.createElement("small",{className:t.link,onClick:function(){return B(!0)}},"See all ECN"))))},(_?[]:W).map(function(e){var a=F[e.uuid]||[];return r.a.createElement(M.a,{button:!0,key:e.uuid,onClick:function(){return L(e)},selected:e.uuid===z.uuid},r.a.createElement($.a,null,r.a.createElement(m.a,{style:{"--statusColor":pe[e.daemonStatus]},className:t.avatarList},r.a.createElement(ce.a,null))),r.a.createElement(U.a,{primary:e.name,secondary:"".concat(a.length," Microservices")}),r.a.createElement("div",{className:t.msvcChipList},a.map(function(a,n){return r.a.createElement(r.a.Fragment,{key:a.uuid},r.a.createElement(R.a,{size:"small",label:a.name,style:{"--mTop":n?"2px":"0px","--color":de["RUNNING"===e.daemonStatus&&a.flowActive?"RUNNING":"UNKNOWN"]},className:t.msvcChip,title:a.name}))})),r.a.createElement(ne.a,{onClick:J}))})),r.a.createElement(Ee,{open:u,title:"".concat(z.name," details"),onClose:function(){return p(!1)}},r.a.createElement(Wt,null,r.a.createElement(X.a,{title:"Agent",src:z,name:!1}),r.a.createElement(X.a,{title:"Microservices",src:F[z.uuid],name:!1}))),r.a.createElement(Ee,{open:E,title:"Deploy microservice to ".concat(z.name),onClose:function(){return x(!1)}},r.a.createElement(At,{target:z,microservices:D,onSuccess:function(){return x(!1)}})),r.a.createElement(Ee,{open:O,title:"Remove microservice from ".concat(z.name),onClose:function(){return C(!1)}},r.a.createElement(Rt,{target:z,msvcs:F[z.uuid]||[],onSuccess:function(){return C(!1)}})),r.a.createElement(Ee,{open:g,title:"Connect agent",onClose:function(){return b(!1)}},r.a.createElement(ct,{controller:e.controller,onSuccess:function(){return b(!1)}})),r.a.createElement(ke,{open:c,title:"Remove agent: ".concat(z.name),onClose:function(){return o(!1)},onConfirm:function(){return K(z)}},r.a.createElement(I.a,{variant:"h5"},"Confirm removal of agent UUID: ",z.uuid)),r.a.createElement(ee.a,{id:"agent-menu",anchorEl:S,keepMounted:!0,open:Boolean(S),onClose:H},r.a.createElement(te.a,{onClick:function(){p(!0),H()}},"Details")))}var Bt=a(122),_t=a.n(Bt),qt=a(123),Gt=a(282),Ht=a(124),Jt=a.n(Ht),Kt=Object(T.a)(function(e){return{mapMarkerTransform:{transform:"translate(-50%, -100%)",position:"absolute"},msvcBadge:{"& .MuiBadge-badge":{backgroundColor:"var(--color, ".concat(e.colors.cobalt,")")}},mapMarker:{backgroundColor:"var(--markerColor, ".concat(e.colors.success,")"),borderRadius:"50% 50% 50% 0 !important",border:"2px solid var(--markerColor, ".concat(e.colors.success,")"),transform:"rotate(-45deg)","& .MuiSvgIcon-root":{transform:"rotate(-45deg)"}},mapWrapper:{boxShadow:"0px 1px 3px 0px rgba(0,0,0,0.2), 0px 1px 1px 0px rgba(0,0,0,0.14), 0px 2px 1px -1px rgba(0,0,0,0.12)",borderRadius:"4px",width:"100%",height:"100%",maxHeight:"700px",position:"sticky",top:"25px",borderColor:e.colors.aluminium,"& div":{borderRadius:"4px","& div":{borderRadius:"4px"}}}}}),Vt=function(e){return Object(C.isFinite)(e[0])&&Object(C.isFinite)(e[1])};function Yt(e){var t=Kt(),a=Object(G.a)(),n=r.a.useRef(),c=e.controller,o=e.agent,l=e.setAgent,s=e.msvcsPerAgent,i=e.map,u=e.autozoom,p=e.loading;return u&&window.google&&function(){var e=new window.google.maps.LatLngBounds,t=(c.agents||[]).filter(function(e){return Vt([e.latitude,e.longitude])});if(!t.length)return i.center=[Object(C.get)(c,"info.location.lat",0),Object(C.get)(c,"info.location.lon",0)],void(i.zoom=9);t.forEach(function(t){e.extend(new window.google.maps.LatLng(Object(C.get)(t,"latitude",0),Object(C.get)(t,"longitude",0)))}),e.extend(new window.google.maps.LatLng(Object(C.get)(c,"info.location.lat",0),Object(C.get)(c,"info.location.lon",0)));var a={ne:{lat:e.getNorthEast().lat(),lng:e.getNorthEast().lng()},sw:{lat:e.getSouthWest().lat(),lng:e.getSouthWest().lng()}},r={width:Object(C.get)(n,"current.offsetWidth",600),height:Object(C.get)(n,"current.offsetHeight",800)},o=Object(qt.fitBounds)(a,r),l=o.center,s=o.zoom;i.center=l,i.zoom=s}(),r.a.createElement("div",{className:t.mapWrapper,ref:n},r.a.createElement(_t.a,Object.assign({},i,{bootstrapURLKeys:{key:"AIzaSyChp_fUXiK05ulRl_ewRGKWsQ1k0ULIFkA"}}),(p?[]:c.agents).filter(function(e){return Vt([e.latitude,e.longitude])}).map(function(e){return r.a.createElement("div",{key:e.uuid,lat:e.latitude,lng:e.longitude,className:t.mapMarkerTransform,onClick:function(){return l(e)}},r.a.createElement(Gt.a,{color:"primary",style:{"--color":de[e.daemonStatus]},badgeContent:(s[e.uuid]||[]).filter(function(e){return e.flowActive}).length,invisible:e.uuid!==o.uuid,className:"".concat(t.msvcBadge)},r.a.createElement(m.a,{style:{"--markerColor":pe[e.daemonStatus]},className:t.mapMarker},r.a.createElement(ce.a,null))))}),!p&&c.info&&Vt([c.info.location.lat,c.info.location.lon])&&r.a.createElement(m.a,{lat:c.info.location.lat,lng:c.info.location.lon,style:{"--markerColor":a.colors.argon},className:t.mapMarker},r.a.createElement(Jt.a,null))))}a(225);var Qt=a(125),Xt=Object(T.a)({divider:{margin:"15px 0"}}),Zt={controller:{info:{location:{},user:{}},agents:[],flows:[],microservices:[]},agent:{},activeAgents:[],activeFlows:[],activeMsvcs:[],msvcsPerAgent:[]},$t={UPDATE:"UPDATE",SET_AGENT:"SET_AGENT"},ea=function(e,t){switch(t.type){case $t.UPDATE:return function(e,t){if(!t)return e;var a=t.flows.filter(function(e){return!0===e.isActivated}),n=t.agents.filter(function(e){return"RUNNING"===e.daemonStatus}),r=Object(C.groupBy)(t.microservices.map(function(e){return Object(O.a)({},e,{flowActive:!!Object(C.find)(a,function(t){return e.flowId===t.id})})}),"iofogUuid"),c=n.reduce(function(e,t){return e.concat(Object(C.get)(r,t.uuid,[]).filter(function(e){return!!Object(C.find)(a,function(t){return t.id===e.flowId})})||[])},[]);return e.agent&&e.agent.uuid||(e.agent=t.agents[0]||{}),Object(O.a)({},e,{controller:t,activeFlows:a,activeAgents:n,activeMsvcs:c,msvcsPerAgent:r})}(e,t.data);case $t.SET_AGENT:return Object(O.a)({},e,{agent:t.data});default:return e}};function ta(){var e=Xt(),t=r.a.useReducer(ea,Zt),a=Object(s.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(!0),i=Object(s.a)(l,2),u=i[0],m=i[1],p=Object(n.useState)(!0),d=Object(s.a)(p,2),f=d[0],g=d[1],b=Object(n.useState)(!1),v=Object(s.a)(b,2),h=v[0],E=v[1],x=Object(n.useState)({center:[0,0],zoom:15,options:{styles:Qt}}),y=Object(s.a)(x,2),k=y[0],T=y[1],S=r.a.useContext(Ye),A=S.controller,I=S.request;r.a.useEffect(function(){g(!0),E(null)},[A]);var F=function(){var e=Object(j.a)(w.a.mark(function e(){var t,a,n,r,c,l,s,i,u,m,p,d;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("/api/v3/iofog-list");case 2:if((t=e.sent).ok){e.next=6;break}return E({message:t.statusText}),e.abrupt("return");case 6:return e.next=8,t.json();case 8:return a=e.sent.fogs,e.next=11,I("/api/v3/flow");case 11:if((n=e.sent).ok){e.next=15;break}return E({message:n.statusText}),e.abrupt("return");case 15:return e.next=17,n.json();case 17:r=e.sent.flows,c=[],l=!0,s=!1,i=void 0,e.prev=22,u=r[Symbol.iterator]();case 24:if(l=(m=u.next()).done){e.next=40;break}return p=m.value,e.next=28,I("/api/v3/microservices?flowId=".concat(p.id));case 28:if(d=e.sent,n.ok){e.next=32;break}return E({message:d.statusText}),e.abrupt("return");case 32:return e.t0=c,e.next=35,d.json();case 35:e.t1=e.sent.microservices,c=e.t0.concat.call(e.t0,e.t1);case 37:l=!0,e.next=24;break;case 40:e.next=46;break;case 42:e.prev=42,e.t2=e.catch(22),s=!0,i=e.t2;case 46:e.prev=46,e.prev=47,l||null==u.return||u.return();case 49:if(e.prev=49,!s){e.next=52;break}throw i;case 52:return e.finish(49);case 53:return e.finish(46);case 54:f&&g(!1),h&&E(!1),o({type:$t.UPDATE,data:{agents:a,flows:r,microservices:c}});case 57:case"end":return e.stop()}},e,null,[[22,42,46,54],[47,,49,53]])}));return function(){return e.apply(this,arguments)}}();!function(e,t){var a=Object(n.useRef)();Object(n.useEffect)(function(){a.current=e},[e]),Object(n.useEffect)(function(){if(null!==t){var e=setInterval(function(){a.current()},t);return function(){return clearInterval(e)}}},[t])}(function(){F()},[3e3]);var R=function(e){return o({type:$t.SET_AGENT,data:e})},P=c.controller,M=c.activeAgents,D=c.activeFlows,U=c.activeMsvcs,W=c.agent,z=c.msvcsPerAgent;return r.a.createElement("div",{className:"viewer-layout-container"},r.a.createElement("div",{className:"box sidebar"},r.a.createElement(J,{controller:A,selectController:function(){T(Object(O.a)({},k,{center:[A.location.lat,A.location.lon],zoom:15})),m(!1)},loading:f,error:h}),r.a.createElement(N.a,{className:e.divider}),r.a.createElement(Y,{activeAgents:M,activeFlows:D,activeMsvcs:U,loading:f}),r.a.createElement(N.a,{className:e.divider}),r.a.createElement(Lt,{msvcsPerAgent:z,loading:f,msvcs:P.microservices,agents:P.agents,agent:W,setAgent:function(e){R(e),Object(C.isFinite)(e.latitude)&&Object(C.isFinite)(e.longitude)&&(T(Object(O.a)({},k,{center:[e.latitude,e.longitude],zoom:15})),m(!1))},centerMap:function(e){T(Object(O.a)({},k,{center:e}))},setAutozoom:m,controller:P.info})),r.a.createElement("div",{className:"map-grid-container"},r.a.createElement(Yt,{controller:Object(O.a)({},P,{info:A}),agent:W,setAgent:R,msvcsPerAgent:z,map:k,autozoom:u,setAutozoom:m,loading:f})))}var aa=Object(T.a)({skeleton:{minHeight:"55px"}});function na(e){var t=aa(),a=r.a.useContext(We).pushFeedback,n=r.a.useContext(Ye),c=n.controller,o=n.updateController,l=r.a.useState(Object(O.a)({},c)),i=Object(s.a)(l,2),u=i[0],m=i[1],p=function(){var t=Object(j.a)(w.a.mark(function t(){return w.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o(u);case 3:a({message:"Controller details saved!",type:"success"}),e.onSave(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a({message:t.t0.message,type:"error"});case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(){return t.apply(this,arguments)}}(),d=function(e){return function(t){m(Object(O.a)({},u,Object(qe.a)({},e,t.target.value)))}},f=function(e){return function(t){m(Object(O.a)({},u,{user:Object(O.a)({},u.user,Object(qe.a)({},e,t.target.value))}))}};return r.a.createElement(r.a.Fragment,null,u.dev&&r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"ip",label:"IP",onChange:d("ip"),value:u.ip,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"})),r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"port",label:"Port",onChange:d("port"),value:u.port,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"}))),r.a.createElement(xe.a,{container:!0,spacing:2},r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"email",label:"Email",onChange:f("email"),value:u.user.email,fullWidth:!0,className:t.textField,margin:"normal",variant:"outlined"})),r.a.createElement(xe.a,{item:!0,xs:12,sm:6},r.a.createElement(Ge.a,{id:"password",label:"Password",onChange:f("password"),value:u.user.password,fullWidth:!0,type:"password",className:t.textField,margin:"normal",variant:"outlined"}))),r.a.createElement(xe.a,{container:!0,justify:"flex-end"},r.a.createElement(xe.a,{item:!0},r.a.createElement(ge.a,{onClick:p},"Save"))))}var ra=a(126),ca=a.n(ra),oa=(a(226),Object(T.a)(function(e){return{wrapper:{color:e.colors.carbon,backgroundColor:e.colors.silver},divider:{margin:"15px 0"},logo:{backgroundColor:e.colors.phosphorus,color:e.colors.white},latNav:{backgroundColor:e.colors.carbon},avatarContainer:{backgroundColor:e.colors.phosphorus,marginRight:"45px"},latIcons:{margin:"auto",marginTop:"15px",cursor:"pointer",backgroundColor:e.colors.carbon,".active &":{backgroundColor:e.colors.aluminium}},topIcons:{height:"100%",width:"25px",marginRight:"25px",cursor:"pointer"},nav:{marginBottom:"15px",height:"50px","& a":{height:"100%","& img":{height:"100%"}}},footerContainer:{display:"flex",justifyContent:"space-around",justifyItems:"center",padding:"20px 10px 20px 0px"},footer:{color:e.colors.aluminium,display:"flex",flexDirection:"column",justifyContent:"flex-end",fontSize:"9pt"}}}));function la(){var e=oa(),t=r.a.useContext(Ye).controller,a=r.a.useState(!(t.user.email&&t.user.password)),n=Object(s.a)(a,2),c=n[0],o=n[1];return console.log(" ====> Rendering layout"),r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,null,r.a.createElement("div",{className:e.wrapper+" wrapper"},r.a.createElement("div",{className:e.logo+" logo"},r.a.createElement(i.b,{to:"/overview"},r.a.createElement("img",{src:ca.a,alt:"Edgeworx logomark"}))),r.a.createElement("div",{className:"topnav"},r.a.createElement(d.a,{className:e.topIcons}),r.a.createElement(g.a,{className:e.topIcons}),r.a.createElement(m.a,{className:e.avatarContainer},"M")),r.a.createElement("div",{className:e.latNav+" latnav"},r.a.createElement(i.b,{to:"/overview"},r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(v.a,null))),r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(E.a,null)),r.a.createElement(m.a,{className:e.latIcons},r.a.createElement(y.a,{onClick:function(){return o(!c)}}))),r.a.createElement("div",{className:"content"},r.a.createElement(u.d,null,r.a.createElement(u.b,{path:"/overview",component:ta}),r.a.createElement(u.b,{component:function(){return r.a.createElement(u.a,{to:"/overview"})}}))),r.a.createElement("div",{className:"".concat(e.footerContainer," footer")},r.a.createElement("span",{className:e.footer},"Copyright \xa9 2019 Edgeworx, Inc. All Rights Reserved.")))),r.a.createElement(Ee,{open:c,title:t.dev?"Controller details":"User credentials",onClose:function(){return o(!1)}},r.a.createElement(na,{onSave:function(){return o(!1)}})))}a(228);var sa=function(){return console.log(" ======> Rendering app "),r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,null),r.a.createElement(me,null,r.a.createElement(tt,null,r.a.createElement(_e,null,r.a.createElement(la,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(sa,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},37:function(e){e.exports={port:"51121",user:{email:"",password:""}}}},[[142,1,2]]]);
//# sourceMappingURL=main.e1b32eeb.chunk.js.map